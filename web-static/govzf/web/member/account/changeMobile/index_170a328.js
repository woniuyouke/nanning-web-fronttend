define("web:static/member/account/changeMobile/index.js",function(e){"use strict";e.async(["common:components/jquery/jquery.js","common:components/pcUI/dialog/dialog.js","common:components/pcUI/tips/tips.js"],function(e){var s,t={config:{sBaseInfoUrl:"/web/account/C/baseinfoC",sLoginUrl:"/web/account/login",sendMsgCaptchaUrl:"/web/account/reset/msgcodeC",validateUrl:"/web/account/reset/msgcodevalidate",imgCaptchaUrl:"/web/account/imgcode",sendNewMsgCaptchaUrl:"/web/account/msgcodeC",submitUrl:"/web/account/reset/mobile",sNextUrl:myHeader.config.loginUrl},info:{name:"",identity:"",msgCode:""},init:function(){var e=this;e.bindEvent()},bindEvent:function(){var s=this;e("#J_send_captcha").on("click",function(){e(this).hasClass("disabled")||s.formValid()&&(e(this).addClass("disabled"),s.sendCaptchaAjax())}),e("#J_validate").click(function(){var t=e("#J_set_step1 #msgCaptcha").val().trim();return""==t?void e("#J_set_step1 .error-msg").removeClass("info").html("请输入短信验证码！"):/^\d{6}$/.test(t)?void s.validate():void e("#J_set_step1 .error-msg").removeClass("info").html("验证码为6位数字")}),e("#J_regcode_img,#J_change_img_btn").on("click",function(){var t=s.config.imgCaptchaUrl+"?random="+Math.random();e("#J_regcode_img").attr("src",t)}),e("#J_regcode_img").trigger("click"),e("#J_send_captcha_new").on("click",function(){var t=e("#imgCaptcha").val().trim(),a=e("#msgMobile").val().trim();if(!e(this).hasClass("disabled")){if(""==a||!/^1\d{10}$/.test(a))return void e("#J_set_step2 .error-msg").removeClass("info").html("请输入正确的手机号！");if(""==t)return void e("#J_set_step2 .error-msg").removeClass("info").html("请输入图形验证码！");e(this).addClass("disabled"),s.sendNewCaptchaAjax()}}),e("#J_submit").click(function(){if(!e(this).hasClass("disabled")){if(!s.formValidMobile())return;e(this).addClass("disabled"),s.submit()}})},sendNewCaptchaAjax:function(){var s=this,t={mobile:e("#msgMobile").val(),imgAuthCode:e("#imgCaptcha").val(),type:3};e.ajax({url:s.config.sendNewMsgCaptchaUrl,type:"POST",contentType:"application/json;charset=utf-8",data:JSON.stringify(t),success:function(t){t.success?(s.activeClock(e("#J_send_captcha_new")),e("#J_set_step2 .error-msg").addClass("info").html("短信已成功发送")):(e("#J_send_captcha_new").removeClass("disabled"),e("#J_set_step2 .error-msg").removeClass("info").html(t.msg),e("#J_regcode_img").trigger("click"))},error:function(){e("#J_send_captcha_new").removeClass("disabled"),e("#J_set_step2 .error-msg").removeClass("info").html("接口获取失败！")}})},formValidMobile:function(){var s=e("#msgMobile").val().trim(),t=e("#msgNewCaptcha").val().trim();return""!=s&&/^1\d{10}$/.test(s)?""==t?void e("#J_set_step2 .error-msg").removeClass("info").html("请输入短信验证码！"):/^\d{6}$/.test(t)?!0:void e("#J_set_step2 .error-msg").removeClass("info").html("验证码为6位数字"):void e("#J_set_step2 .error-msg").removeClass("info").html("请输入正确的手机号！")},submit:function(){var s=this,t={bizType:"MOBILE",mobile:e("#msgMobile").val().trim(),msgAuthCode:e("#msgNewCaptcha").val().trim(),name:s.info.name,identity:s.info.identity,msgCode:s.info.msgCode};e.ajax({url:s.config.submitUrl,type:"POST",contentType:"application/json;charset=utf-8",data:JSON.stringify(t),success:function(t){e("#J_submit").removeClass("disabled"),t.success?window.location.href=s.config.sNextUrl:e("#J_set_step2 .error-msg").removeClass("info").html(t.msg)},error:function(){e("#J_submit").removeClass("disabled"),e("#J_set_step2 .error-msg").removeClass("info").html("接口获取失败！")}})},validate:function(){var s=this,t={bizType:"MOBILE",msgCode:e("#msgCaptcha").val().trim()};e.ajax({url:s.config.validateUrl,type:"POST",contentType:"application/json;charset=utf-8",data:JSON.stringify(t),success:function(a){e("#J_validate").removeClass("disabled"),a.success?(e("#J_set_step1").addClass("hide"),e("#J_validate").addClass("hide"),e("#J_set_step2").removeClass("hide"),s.info.msgCode=t.msgCode):e("#J_set_step1 .error-msg").removeClass("info").html(a.msg)},error:function(){e("#J_validate").removeClass("disabled"),e("#J_set_step1 .error-msg").removeClass("info").html("接口获取失败！")}})},activeClock:function(e){function t(){a?e.text("重新获取"+a--+"s"):(e.text("重新获取").removeClass("disabled"),clearInterval(s))}clearInterval(s);var a=60;t(),s=setInterval(t,1e3)},sendCaptchaAjax:function(){var s=this,t={bizType:"MOBILE",name:e("#realName").val().trim(),identity:e("#IDCard").val().trim()};e.ajax({url:s.config.sendMsgCaptchaUrl,type:"POST",contentType:"application/json;charset=utf-8",data:JSON.stringify(t),success:function(a){a.success?(s.activeClock(e("#J_send_captcha")),e("#J_set_step1 .error-msg").addClass("info").html("短信已成功发送"),s.info.name=t.name,s.info.identity=t.identity):(e("#J_send_captcha").removeClass("disabled"),e("#J_set_step1 .error-msg").removeClass("info").html(a.msg))},error:function(){e("#J_send_captcha").removeClass("disabled"),e("#J_set_step1 .error-msg").removeClass("info").html("接口获取失败！")}})},formValid:function(){var s=e("#realName").val().trim(),t=e("#IDCard").val().trim();return s.length<2||s.length>30||!/^[\u4e00-\u9fa5]+(·[\u4e00-\u9fa5]+)*$/.test(s)?void e("#J_set_step1 .error-msg").removeClass("info").html("请输入真实姓名！"):""!=t&&/^(?:\d{14}|\d{17})[\dx]$/i.test(t)?!0:void e("#J_set_step1 .error-msg").removeClass("info").html("请输入正确的身份证号！")},login:function(){var s=this,t={loginNo:e("#sLoginNo").val().trim(),password:e("#sPwd").val().trim()};e.ajax({url:s.config.sLoginUrl,type:"POST",contentType:"application/json;charset=utf-8",data:JSON.stringify(t),success:function(s){return s.success?void window.location.reload():void e(".error-msg").text(s.msg)},error:function(){}})}};t.init()})});