define("web:static/member/account/resetPwd/index.js",function(e){"use strict";e.async(["common:components/jquery/jquery.js","common:components/pcUI/dialog/dialog.js","common:components/pcUI/tips/tips.js","common:components/ui/getQueryString/getQueryString.js","common:components/jsencrypt/jsencrypt.js","common:components/publickey/publickey.js"],function(e,s,t,a,n,i){var o,r={config:{sBaseInfoUrl:"/web/account/C/baseinfoC",sLoginUrl:"/web/account/login",sendMsgCaptchaUrl:"/web/account/reset/msgcodeC",validateUrl:"/web/account/reset/msgcodevalidate",imgCaptchaUrl:"/web/account/imgcode",sendNewMsgCaptchaUrl:"/web/account/msgcode",submitUrl:"/web/account/reset/mobile",resetPWDUrl:"/web/account/reset/login",sNextUrl:myHeader.config.loginUrl},info:{name:"",identity:"",msgCode:""},init:function(){var e=this;e.bindEvent()},bindEvent:function(){var s=this;e("#J_send_captcha").on("click",function(){s.formValid()&&(e(this).addClass("disabled"),s.sendCaptchaAjax())}),e("#J_validate").click(function(){var t=e("#J_set_step1 #msgCaptcha").val().trim();return""==t?void e("#J_set_step1 .error-msg").removeClass("info").html("请输入短信验证码！"):/^\d{6}$/.test(t)?void s.validate():void e("#J_set_step1 .error-msg").removeClass("info").html("验证码为6位数字")}),e("#J_submit").click(function(){if(!e(this).hasClass("disabled")){if(!s.formValidPwd())return;e(this).addClass("disabled"),s.submit()}})},formValidPwd:function(){var s=e("#sPwd").val().trim(),t=e("#sConfirmPwd").val().trim();return""==s||/[\u4E00-\u9FA5\uF900-\uFA2D]/.test(s)||/[\uFF00-\uFFEF]/.test(s)||!/^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]{6,15}$/.test(s)?void e("#J_set_step2 .error-msg").removeClass("info").html("密码最短6位且包含字母和数字！"):s!=t?void e("#J_set_step2 .error-msg").removeClass("info").html("两次输入密码不一致！"):!0},sendNewCaptchaAjax:function(){var s=this,a={mobile:e("#msgMobile").val(),imgAuthCode:e("#imgCaptcha").val(),type:3};e.ajax({url:s.config.sendNewMsgCaptchaUrl,type:"POST",contentType:"application/json;charset=utf-8",data:JSON.stringify(a),success:function(a){a.success?(s.activeClock(e("#J_send_captcha_new")),t.show("短信已成功发送")):(e("#J_send_captcha_new").removeClass("disabled"),t.show(a.msg),e("#J_regcode_img").trigger("click"))},error:function(){e("#J_send_captcha_new").removeClass("disabled"),t.show("接口获取失败！")}})},submit:function(){var s=this,a=new JSEncrypt;a.setKey(i);var n={bizType:"LOGIN_PASSWORD",checkPassword:a.encrypt(e("#sConfirmPwd").val().trim()),password:a.encrypt(e("#sPwd").val().trim()),name:s.info.name,identity:s.info.identity,msgCode:s.info.msgCode};e.ajax({url:s.config.resetPWDUrl,type:"POST",contentType:"application/json;charset=utf-8",data:JSON.stringify(n),success:function(a){e("#J_submit").removeClass("disabled"),a.success?(t.show("密码修改成功"),s.activeClockToBack()):e("#J_set_step2 .error-msg").removeClass("info").html(a.msg)},error:function(){e("#J_submit").removeClass("disabled"),t.show("接口获取失败！")}})},activeClockToBack:function(){var s=this;clearInterval(o);var t=2;o=setInterval(function(){t?e("#J_second").text(t--):(location.replace(s.config.sNextUrl),clearInterval(o))},1e3)},validate:function(){var s=this,a={bizType:"LOGIN_PASSWORD",msgCode:e("#msgCaptcha").val().trim()};e.ajax({url:s.config.validateUrl,type:"POST",contentType:"application/json;charset=utf-8",data:JSON.stringify(a),success:function(t){e("#J_validate").removeClass("disabled"),t.success?(e("#J_set_step1").addClass("hide"),e("#J_validate").addClass("hide"),e("#J_set_step2").removeClass("hide"),s.info.msgCode=a.msgCode):e("#J_set_step1 .error-msg").removeClass("info").html("短信验证码错误")},error:function(){e("#J_validate").removeClass("disabled"),t.show("接口获取失败！")}})},activeClock:function(e){function s(){t?e.text("重新获取"+t--+"s"):(e.text("重新获取").removeClass("disabled"),clearInterval(o))}clearInterval(o);var t=60;s(),o=setInterval(s,1e3)},sendCaptchaAjax:function(){var s=this,a={bizType:"LOGIN_PASSWORD",name:e("#realName").val().trim(),identity:e("#IDCard").val().trim()};e.ajax({url:s.config.sendMsgCaptchaUrl,type:"POST",contentType:"application/json;charset=utf-8",data:JSON.stringify(a),success:function(t){t.success?(s.activeClock(e("#J_send_captcha")),e("#J_set_step1 .error-msg").addClass("info").html("短信已成功发送"),s.info.name=a.name,s.info.identity=a.identity):(e("#J_send_captcha").removeClass("disabled"),e("#J_set_step1 .error-msg").removeClass("info").html(t.msg))},error:function(){e("#J_send_captcha").removeClass("disabled"),t.show("接口获取失败！")}})},formValid:function(){var s=e("#realName").val().trim(),t=e("#IDCard").val().trim();return s.length<2||s.length>30||!/^[\u4e00-\u9fa5]+(·[\u4e00-\u9fa5]+)*$/.test(s)?void e("#J_set_step1 .error-msg").removeClass("info").html("请输入真实姓名！"):""!=t&&/^(?:\d{14}|\d{17})[\dx]$/i.test(t)?!0:void e("#J_set_step1 .error-msg").removeClass("info").html("请输入正确的身份证号！")}};r.init()})});