define("web:static/member/account/realAuth/realAuth.js",function(e){"use strict";e.async(["common:components/jquery/jquery.js","common:components/pcUI/tips/tips.js","common:components/pcUI/dialog/dialog.js"],function(e,t){var a={config:{validateUrl:"/web/validate/bioValidate"},data:"",accountId:null,personId:"",personName:"",init:function(){var e=this;this.bindEvent(),e.getRealAuthStatus(),setInterval(function(){e.getRealAuthStatus()},1e3)},bindEvent:function(){var t=this;e("#show-popup").on("mouseover",function(){e("#popup").show()}),e("#show-popup").on("mouseout",function(){e("#popup").hide()}),e("#startAuth").on("click",function(){t.getFace()}),e("#newAuth").click(function(){t.getFace()}),e("#picSc").click(function(){location.href="/pc/account/accountAppeal"}),e(".dialog-wrapper").dialog({customWraper:!0}),e("#download").on("click",".close-btn",function(){e("#download").dialog("instance").close()}),e("#download").on("click",".download-btn",function(){location.href=pluginUrl,e("#download").dialog("instance").close()})},validate:function(t){var a=this;e.ajax({url:a.config.validateUrl,type:"POST",contentType:"application/json;charset=utf-8",data:JSON.stringify({device:{model:"MBP 2017",plat:"3",version:"10.3.3"},file:{data:t,type:"jpg"},personId:a.personId,personName:a.personName}),success:function(n){n.data?(a.data=t,a.faceValidate()):e(".error-msg").text("认证失败")},error:function(){}})},faceValidate:function(){var a=this;e.ajax({url:"/web/validate/faceValidate",type:"POST",contentType:"application/json;charset=utf-8",data:JSON.stringify({device:{model:"MBP 2017",plat:"3",version:"10.3.3"},ext:"jpg",key:a.data}),success:function(a){a.data.isValidateSuccess?(t.show("认证成功"),setTimeout(function(){location.href="/pc/user/setting"},1e3)):(e(".error-msg").text("认证失败"),e("#startAuth").addClass("hidden"),e("#newAuth").removeClass("hidden"),a.data.faceTimes>=3&&e("#picSc").removeClass("hidden"))},error:function(){}})},getFace:function(){var t=this,a=document.getElementById("faceGetter"),n="";try{n=a.detectWithPosition(100,100)}catch(o){return void e("#download").dialog("instance").open()}var c="";switch(n){case"-1":c="摄像头打开失败!";break;case"-2":c="人脸模型打开失败!";break;case"-3":c="人脸算法初始化失败!";break;case"-4":c="采集超时!"}if(n.length<=10)e(".error-msg").text(c),a.doConsole();else{var i="jpg",s="data:image/"+i+";base64,"+n;e(".default-img").attr("src",s),t.validate(n),a.doConsole()}},getRealAuthStatus:function(){var a=this;e.ajax({url:"/web/account/C/baseinfoC",type:"GET",success:function(e){if(e.success){var t=e.data;2==t.faceVerificationStatus&&(window.location.href="/pc/user/setting"),a.accountId||(a.accountId=t.id),a.personId||(a.personId=t.identity),a.personName||(a.personName=t.name)}},error:function(){t.show("网络错误")}})}};a.init()})});