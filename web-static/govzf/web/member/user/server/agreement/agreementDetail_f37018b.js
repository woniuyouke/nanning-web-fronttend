define("web:static/member/user/server/agreement/agreementDetail.js",function(e){"use strict";function t(e,t){var a={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(a[n]=e[n]);return a}e.async(["common:components/jquery/jquery.js","common:components/pcUI/uploader/uploader.js","common:components/pcUI/calendar/calendar.js","common:components/pcUI/tips/tips.js","common:components/pcUI/formValid/formValid.js","common:components/ui/loading/loading.js"],function(e,a,n,i,s,o){var c=!1,r={config:{contractAttachment:[]},param:{},crpInfo:[],crpStatus:0,check_data:{ownerType:"出租方类型",ownerPerson:"出租方名称",ownerCertificateIdType:"出租方证件类型",ownerCertificateId:"出租方证件号码",ownerMobile:"出租方联系方式",tenantType:"承租方类型",tenantPerson:"承租方名称",tenantCertificateIdType:"承租方证件类型",tenantCertificateId:"承租方证件号码",tenantFamilyMobile:"承租方联系方式",houseAddress:"房屋详细地址",rentType:"出租方式",rentPosition:"租赁部位",space:"租赁面积",rentExpense:"租金",contractStartTime:"租赁合同开始时间",contractEndTime:"租赁合同结束时间",rentUsage:"租赁用途",contractAttachment:"合同附件"},space:0,houseId:"",contractFillingId:"",init:function(){var e=this;e.loading=new o,e.getHouseAddress(),e.uploaderImg(),e.bindEvents(),e.clicks(),e.initLayout()},uploaderImg:function(){var t=this;e("#contractAppendices").on("click",function(){e("#contractAppendicesInput").trigger("click")}),e("#contractAppendicesInput").on("change",function(a){var n=new FormData,i=a.target.files||a.dataTransfer.files;for(var s in i)n.append("part"+s,i[s]);t.loading.open(),e.ajax({url:"http://"+window.configPager.postPicsUrl+"/upload/house.html",type:"post",data:n,contentType:!1,processData:!1,cache:!1,success:function(a){for(var n in a){var i={imgKey:a[n].sKey,imgExt:a[n].sExt};if(t.config.contractAttachment.push(i),/^(png|jpe?g)$/.test(a[n].sExt)){var s="http://"+window.configPager.viewUrl+"/view/house/"+a[n].sKey+"/900x675."+a[n].sExt,o=e('<div class="image-item"><img src="'+s+'"><a class="images-del">x</a><a class="preview-image">预览</a></div>');e("#contractAppendices-img-uploader").append(o)}}},complete:function(){t.loading.hide()}})})},initAjax:function(){e.ajax({url:window.configPager.cityUrl,type:"get",dataType:"json",success:function(t){if(t.success){var a=t.data.district;for(var n in a){var i="<option>"+a[n].name+"</option>";e(".district").append(i)}}else console.log(t.errorCode)}})},getHouseAddress:function(){e.ajax({url:window.configPager.getHouseAddress,type:"get",dataType:"json",success:function(t){if(t.success){var a=t.data.list,n='<option value="">请选择</option>';for(var i in a)n+="<option value="+a[i].id+" key="+a[i].id+" } >"+a[i].houseLocated+"</option>";e(".houseAddressCheck").append(n)}else console.log(t.errorCode)}})},checkHouseAddress:function(){var t=this;e.ajax({url:"/web/goverp/api/house/"+t.houseId+"/verify/"+t.contractFillingId,type:"get",dataType:"json",success:function(a){a.success?a.data&&"审核通过"===a.data.businessStatus?t.goLastStep(a.data.contractFillingDTO):a.msg&&i.warn(a.msg):e(".info-wrap").show()}})},goLastStep:function(t){e(".verify_btn").hide(),e(".add-new").hide(),e(".houseCheck").addClass("unchange"),e(".houseAddressCheck").attr("disabled","disabled"),e(".houseInfo").show(),e(".chu_type").val(t.ownerType).attr("disabled","disabled").addClass("disabled"),e(".rentName").val(t.ownerPerson).attr("disabled","disabled").addClass("disabled"),e(".rentPhone").val(t.ownerMobile).attr("disabled","disabled").addClass("disabled"),e(".rentPaperNum").val(t.ownerCertificateId).attr("disabled","disabled").addClass("disabled"),e(".certitype").val(t.ownerCertificateIdType).attr("disabled","disabled").addClass("disabled");var a="";if(this.crpStatus=t.crpStatus,t.crpInfo&&t.crpInfo.length>0){for(var n in t.crpInfo)a+=this.createOwner(t.crpInfo[n],n+1),this.crpInfo.push({idcard:t.crpInfo[n].idcard,mobile:t.crpInfo[n].mobile,name:t.crpInfo[n].name});e(".crpowner").append(a)}e(".sale-type").val(t.tenantType).attr("disabled","disabled").addClass("disabled"),e(".saleName").val(t.tenantPerson).attr("disabled","disabled").addClass("disabled"),e(".salePhone").val(t.tenantFamilyMobile).attr("disabled","disabled").addClass("disabled"),e(".tenant-certitype").val(t.tenantCertificateIdType).attr("disabled","disabled").addClass("disabled"),e(".salePaperNum").val(t.tenantCertificateId).attr("disabled","disabled").addClass("disabled"),e(".houseAddress").val(t.houseAddress).attr("disabled","disabled").addClass("disabled"),e(".rent-application").val(t.rentUsage).attr("disabled","disabled").addClass("disabled"),this.space=t.space||0,e(".success-wrap").show(),setTimeout(function(){e(".success-wrap").hide()},3e3)},createOwner:function(e,t){var a='<div class="owner-wrapper"><div class="title">共有权利人'+t+'</div><div class="container"><div class="container-top clearfix"><div class="row clearfix"><label class="common-label"><span class="required">*</span>共有权利人姓名</label><input type="text" placeholder="请输入共有权利人姓名" disabled value="'+e.name+'" class="ownerInputName"></div><div class="row clearfix"><label class="common-label"><span class="required">*</span>共有权利人证件类型</label><input type="text" placeholder="请输入共有权利人证件类型" disabled value="居民身份证" class="propertyrightno"></div><div class="row clearfix"><label class="common-label ownerLabel"><span class="required">*</span>共有权利人证件号码</label><input type="text" placeholder="请输入共有权利人证件号码" disabled value="'+e.idcard+'" class="ownerInputNum"></div><div class="row clearfix"><label class="common-label"><span class="required">*</span>共有权利人电话</label><input type="text" placeholder="请输入共有权利人电话" disabled value="'+e.mobile+'" class="ownerInputMobile"></div></div></div></div>';return a},bindEvents:function(){var t=this,a="",n="",t=this;e("#startDate").calendar({maxDate:n}).on("calendar:select",function(e,t){return a=t}),e("#endDate").calendar({minDate:a}).on("calendar:select",function(e,t){return n=t}),e(".image-wrapper").on("mouseover mouseout",".image-item",function(){"mouseover"==event.type?e(this).find(".preview-image").show():"mouseout"==event.type&&e(this).find(".preview-image").hide()}),e(".image-wrapper").on("click",".preview-image",function(){e(".big-wrap").show();var t=e(this).parent(".image-item").find("img").attr("src");e(".big-wrap").find("img").attr("src",t)}),e(".close-wrap").on("click",function(){e(".big-wrap").hide()}),e('.msgDiv input[name="faqiFang"]').on("click",function(){var a=e(this).val();t.param.type=a,"0"==a?(i.show("请录入出租方基本信息"),e(".chengZu").show(),e(".chuZu").hide()):"1"==a&&(i.show("请录入承租方基本信息"),e(".chengZu").hide(),e(".chuZu").show())}),e("#closeTips").on("click",function(){e(this).parent("p").remove()}),e("#close-error").on("click",function(){e(".info-wrap").hide()}),e("#contractAppendices-img-uploader").on("click",".images-del",function(){var a=e(this).parent(".image-item"),n=a.index();t.config.contractAttachment.splice(n,1),a.remove()}),e(".houseAddressCheck").on("change",function(){t.houseId=e("option:selected",this).attr("key")}),e(".rentType select").on("change",function(){var a=e("option:selected",this).val()||"";console.log("类型",a),2==a?(e(".rentPosition").show(),e(".rentAre").val("").removeClass("disabled").attr("disabled",!1)):(e(".rentAre").val(t.space/100).addClass("disabled").attr("disabled","disabled"),e(".rentPosition").hide())}),e("#checkBtn").on("click",function(){var a=e('.msgDiv input[name="faqiFang"]:checked').val(),n={};n="1"==a?{mobile:e(".cheng_phone").val(),name:e(".cheng_name").val(),source:Number(a),type:Number(e(".cheng_type").val())}:{mobile:e(".chu_phone").val(),name:e(".chu_name").val(),source:Number(a),type:Number(e(".chu_type").val())};var s={0:{name:"出租方名称",mobile:"出租方联系电话",type:"出租方类型"},1:{name:"承租方名称",mobile:"承租方联系电话",type:"承租方类型"}};t.checkData(n,s[a])&&(console.log(n),e.ajax({url:window.configPager.checkUrl,type:"POST",contentType:"application/json; charset=UTF-8",data:JSON.stringify(n),dataType:"json",success:function(a){a.success?a.data&&1===a.data.source?(e(".add-first").hide(),e(".houseCheck").show(),t.contractFillingId=a.data.contractFillingId):a.msg&&(e("#faqi-toast h3").text(a.msg),e("#faqi-toast").show()):null!=a.fieldErrors?i.warn(a.fieldErrors[0].msg):(e("#ba-toast h3").text(a.msg),e("#ba-toast").show())}}))}),e(".add-new span").on("click",function(){window.location.href="/pc/verify/edit"}),e(".verify_btn").on("click",function(){return t.houseId&&t.contractFillingId?void t.checkHouseAddress():(i.warn("请先选择已核验的房源或新增核验房源"),!1)}),e("#faqi-toast .confirm-btn").on("click",function(){location.href="/pc/user/beian/list"}),e(".close-btn, .confirm-btn").on("click",function(){e("#ba-toast").hide(),e("#faqi-toast").hide(),e("#check-toast").hide(),e(".cancel-toast").hide()}),e(".back").on("click",function(){e(".cancel-toast").show()}),e(".confirm-button").on("click",function(){location.href="/pc/user/beian/list"}),e(".cancel-button").on("click",function(){e(".cancel-toast").hide()}),e("#load_page").hide()},checkPhone:function(t){e.ajax({url:window.configPager.checkUrl+"/"+t,type:"POST",contentType:"application/json; charset=UTF-8",dataType:"json",success:function(t){t.success?t.data?(e(".add-first").hide(),e(".houseCheck").show()):e("#ba-toast").show():i.warn(null!=t.fieldErrors?t.fieldErrors[0].msg:t.msg)}})},checkData:function(e,t){for(var a in e)if((""==e[a]||e[a]==[]||void 0==e[a])&&void 0!=t[a])return i.warn(t[a]+"不能为空"),!1;return!0},initLayout:function(){var t=this.getUrlParam("id")||null;if(null!==t)this.contractFillingId=t,e(".add-first").hide(),e(".houseCheck").show();else{var a=e('.add-first input[type="radio"]:checked').val();"1"!=a&&a?"2"==a&&(e(".chengZu").hide(),e(".chuZu").show()):(e(".chengZu").show(),e(".chuZu").hide())}},getUrlParam:function(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),a=window.location.search.substr(1).match(t);return null!=a?unescape(a[2]):null},clicks:function(){var a=this;e(".submit").on("click",function(){var n={ownerPerson:e(".rentName").val(),ownerCertificateIdType:e("option:selected",".ownerCertificateIdType").val(),ownerCertificateId:e(".rentPaperNum").val(),ownerMobile:e(".rentPhone").val(),crpStatus:a.crpStatus,crpInfo:a.crpInfo,tenantType:e("option:selected",".tenantType").val(),tenantPerson:e(".saleName").val(),tenantCertificateIdType:e("option:selected",".tenantCertificateIdType").val(),tenantCertificateId:e(".salePaperNum").val(),tenantFamilyMobile:e(".salePhone").val(),houseAddress:e(".houseAddress").val(),rentType:e("option:selected",".rentType").val(),rentPosition:e(".rentBu").val(),space:Number((100*Number(e(".rentAre").val())).toFixed(0)),rentExpense:Number((100*Number(e(".rentMoney").val())).toFixed(0)),contractStartTime:e(".startDate").val(),contractEndTime:e(".endDate").val(),rentUsage:e("option:selected",".rentUsage").val(),houseId:Number(a.houseId),id:Number(a.contractFillingId),contractAttachment:a.config.contractAttachment};if(1==n.rentType)var s=(n.rentPosition,n.agencyContractAttachment,n.otherAttachment,t(n,["rentPosition","agencyContractAttachment","otherAttachment"]));else var s=(n.agencyContractAttachment,n.otherAttachment,t(n,["agencyContractAttachment","otherAttachment"]));var o=/^[0-9]+.?[0-9]*$/;if(a.checkData(s,a.check_data)){if(!o.test(n.space))return i.warn("租赁面积请输入数字"),!1;if(!o.test(n.rentExpense))return i.warn("租金请输入数字"),!1;if(2==n.rentType&&n.space>=a.space)return i.warn("租赁面积需要小于建筑面积"),!1;if(n.contractEndTime<n.contractStartTime)return i.warn("合同终止时间不能小于合同起始时间"),!1;if(c)return;c=!0,e.ajax({url:window.configPager.contractFillingUrl,type:"post",contentType:"application/json; charset=UTF-8",data:JSON.stringify(n),dataType:"json",success:function(e){e.success?(i.success("您已发起备案，请等待审核"),setTimeout(function(){c=!1,location.href="/pc/user/beian/list"},5e3)):(c=!1,i.warn(null!=e.fieldErrors?e.fieldErrors[0].msg:e.msg))}})}})}};r.init()})});