define("web:static/member/user/sendRoom/sendRoom.js",function(e){"use strict";e.async(["common:components/jquery/jquery.js","common:components/pcUI/uploader/uploader.js","common:components/pcUI/dialog/dialog.js","common:components/pcUI/suggestion/suggestion.js","common:components/pcUI/cuteTips/cuteTips.js","common:components/ui/loading/loading.js","common:components/pcUI/tooltip/tooltip.js"],function(e,a,t,i,r,o){var n=!1,s={config:{ownerIndex:2,cityData:{},city:"南宁市",postPoint:{}},pics:[],propertyPic:[],propertyIdCardPic:[],proxyPic:[],houseSaleContractProofPic:[],houseDeliveryDescPic:[],index:0,crpInfo:[],isTake:!0,liArr:[],communityId:"",firstOwnerName:"",firstOwnerNum:"",projectName:"",street:"",init:function(){var a=this;a.loading=new o,a.hideContent(!0),a.initAjax(),e(".dialog-wrapper").dialog({customWraper:!0}),a.bindEvents(),a.uploaderImg(),a.delImg(),a.selectCreated(),e("#shili-btn").click(function(){e("#shili-wrap").toggle()}),e("#shili-btn").hover(function(){e("#shili-wrap").toggle()})},rightProofTypeRely:function(){var a=e(".rightProofType option:checked").attr("rightprooftypeindex");if("1"==a||"4"==a){e(".credentials-wrapper").css("display","block"),e(".houseSaleContractProofPic-wrapper").css("display","none"),e(".houseDeliveryDescPic-wrapper").css("display","none"),e(".shili-content").remove();var t='<div class="shili-content"><p>示例1 邕房权证字第XXXXXXXX号</p><p>示例2 桂(2018)南宁市不动产权第XXXXXXX号</p></div>';e("#shili-wrap").append(t),e(".propertyType").attr("disabled","disabled"),e(".propertyType").get(0).selectedIndex="1"}else if("2"==a){e(".credentials-wrapper").css("display","none"),e(".houseSaleContractProofPic-wrapper").css("display","block"),e(".houseDeliveryDescPic-wrapper").css("display","block"),e(".shili-content").remove();var t='<div class="shili-content"><p>示例1 YS0000001</p><p>示例2 QF2018010100000</p></div>';e("#shili-wrap").append(t),e(".propertyType").attr("disabled","disabled"),e(".propertyType").get(0).selectedIndex="2"}else if("3"==a){e(".credentials-wrapper").css("display","none"),e(".houseSaleContractProofPic-wrapper").css("display","block"),e(".houseDeliveryDescPic-wrapper").css("display","block"),e(".shili-content").remove();var t='<div class="shili-content"><p>示例1 YS0000001</p><p>示例2 QF2018010100000</p></div>';e("#shili-wrap").append(t),e(".propertyType").attr("disabled","disabled"),e(".propertyType").get(0).selectedIndex="2"}},selectCreated:function(){var a=this;e("#addOwner").on("click",function(){var t=a.config.ownerIndex-1,i="";for(var r in a.rightProofType)i+='<option rightprooftypeindex="'+r+'">'+a.rightProofType[r]+"</option>";var o='<div class="owner-wrapper"><div class="title">共有权利人'+t+'</div><div class="delete-wrapper clearfix"><i class="iconfont icon-nav_detele color-grey"></i><div class="delete-text">删除</div></div><div class="container"><div class="container-top clearfix"><div class="container-top-rightProofType clearfix"><label class="common-label"><span class="required">*</span>共有权利证明类型</label><div class="clearfix msgDiv"><select class="select-box rightProofType-crp"><option value="">请选择</option>'+i+'</select></div></div><div class="container-top-propertyrightno clearfix"><label class="common-label"><span class="required">*</span>共有权利人所有权证号</label><input type="text" placeholder="请输入共有权利人所有权证号" class="propertyrightno"></div><div class="container-top-left clearfix"><label class="common-label"><span class="required">*</span>共有权利人姓名</label><input type="text" placeholder="请输入共有权利人姓名" class="ownerInputName"></div><div class="container-top-right"><label class="common-label ownerLabel"><span class="required">*</span>共有权利人证件号码</label><input type="text" placeholder="请输入共有权利人证件号码" class="ownerInputNum"></div><div class="container-top-left clearfix" style="margin-top:20px;"><label class="common-label"><span class="required">*</span>共有权利人电话</label><input type="text" placeholder="请输入共有权利人电话" class="ownerInputMobile"></div></div><div class="container-bottom clearfix"><div class="container-bottom-left container-bottom-left-icard clearfix"><label class="common-label creditor-label special-label"><span class="required">*</span>共有权利人证件照片</label><div class="container-tips">(证件正反面)</div></div><div class="pre pre-selectOwnerImg"><div class="container-bottom-right clearfix owner-upload-wrapper'+t+'"><a href="javascript:;" id="selectOwnerImg'+t+'" data-id='+t+' class="upload uploadImg">点此上传</a><input type="file" class="hidden-field" id="selectOwnerImg1Input'+t+'" multiple="multiple"></div></div><div id="owner-img-uploader'+t+'" class="image-wrapper clearfix"></div></div></div></div>';e("#owner").append(o),a.isTake&&a.crpInfo.push({rightProofType:"",propertyRightNo:"",name:"",idcard:"",pics:[]}),a.imgUpload(t),a.imgDelete(t),a.config.ownerIndex++}),e(".contain-main").on("click",".delete-wrapper",function(){var t=e(this).parent().index();e(this).parent().remove();for(var i=0;i<e(".owner-wrapper").length;i++)e(".owner-wrapper .title").eq(i).html("共有权利人"+parseInt(i+1)),e(".owner-wrapper .container-bottom-right>.uploadify").eq(i).attr("id","selectOwnerImg"+parseInt(i+2)),e(".owner-wrapper .image-wrapper").eq(i).attr("id","owner-img-uploader"+parseInt(i+2));a.crpInfo.splice(parseInt(t-1),1),a.config.ownerIndex--})},initAjax:function(){var a=this;e.ajax({url:window.configUrl.dictErpUrl,type:"get",dataType:"json",success:function(t){if(t.success){for(var i in t.data.rightProofType){a.rightProofType=t.data.rightProofType;var r='<option rightprooftypeindex="'+i+'">'+t.data.rightProofType[i]+"</option>";e(".rightProofType").append(r)}e(".rightProofType").get(0).selectedIndex="1",a.rightProofTypeRely(),e("#J_PropertyType").html(t.data.propertyType[1]);for(var i in t.data.situation){var r='<option situationindex="'+i+'">'+t.data.situation[i]+"</option>";e(".situation").append(r)}for(var i in t.data.toward){var r='<option towardindex="'+i+'">'+t.data.toward[i]+"</option>";e(".toward").append(r)}for(var i in t.data.paymentMethod){var r='<option paymentwayindex="'+i+'">'+t.data.paymentMethod[i]+"</option>";e(".paymentWay").append(r)}for(var i in t.data.rentType){var r='<option renttypeindex="'+i+'">'+t.data.rentType[i]+"</option>";e(".rentType").append(r)}for(var i in t.data.natureLand){var r='<option naturelandindex="'+i+'">'+t.data.natureLand[i]+"</option>";e(".natureLand").append(r)}for(var i in t.data.houseTag){var r='<label class="clearfix"><input type="checkbox" housetagindex="'+i+'"><div class="unit">'+t.data.houseTag[i]+"</div></label>";e(".tags").append(r)}for(var i in t.data.houseCollocation){var r='<label class="clearfix"><input type="checkbox" housecollocationindex="'+i+'"><div class="unit">'+t.data.houseCollocation[i]+"</div></label>";e(".collocation").append(r)}for(var i in t.data.landlordRequest){var r='<label class="clearfix"><input type="checkbox" landlordrequestindex="'+i+'"><div class="unit">'+t.data.landlordRequest[i]+"</div></label>";e(".landlordRequest").append(r)}""!=window.configUrl.id&&a.editForm(window.configUrl.id)}}})},uploaderImg:function(){var a=this;e("#owner").on("click",".uploadImg",function(){var a=e(this).attr("data-id");return e("#selectOwnerImg1Input"+a).trigger("click"),!1}),e("#selectOwnerImg1").on("click",function(){e("#selectOwnerImg1Input").trigger("click")}),e("#selectOwnerImg1Input").on("change",function(t){var i=new FormData,o=t.target.files||t.dataTransfer.files;for(var n in o)i.append("part"+n,o[n]);a.loading.open(),e.ajax({url:"http://"+window.configUrl.postPicsUrl+"/upload/house.html",type:"post",data:i,contentType:!1,processData:!1,cache:!1,success:function(t){if(t.code)return r.warn(t.file),!1;for(var i in t){if(2==a.propertyIdCardPic.length)return void r.warn("只能上传两张图片！");if(a.propertyIdCardPic[0]&&a.propertyIdCardPic[0].imgKey&&a.propertyIdCardPic[0].imgKey==t[i].sKey)return void r.warn("请不要上传相同的图片！");var o={imgKey:t[i].sKey,imgExt:t[i].sExt};if(a.propertyIdCardPic.push(o),/^(png|jpe?g)$/.test(t[i].sExt)){e("#selectOwnerImg1Input").val("");var n="http://"+window.configUrl.viewUrl+"/view/house/"+t[i].sKey+"/900x675."+t[i].sExt,s=e('<div class="image-item"><img src="'+n+'"><a class="images-del">x</a><a class="preview-image">预览</a></div>');e(".owner-upload-wrapper").before(s)}}},complete:function(){a.loading.hide()}})}),e("#selectHouseImg").on("click",function(){e("#selectHouseImgInput").trigger("click")}),e("#selectHouseImgInput").on("change",function(t){var i=new FormData,o=t.target.files||t.dataTransfer.files;for(var n in o)i.append("part"+n,o[n]);a.loading.open(),e.ajax({url:"http://"+window.configUrl.postPicsUrl+"/upload/house.html",type:"post",data:i,contentType:!1,processData:!1,cache:!1,success:function(t){if(t.code)return r.warn(t.file),!1;for(var i in t){var o={imgKey:t[i].sKey,imgExt:t[i].sExt};if(a.pics.push(o),/^(png|jpe?g)$/.test(t[i].sExt)){var n="http://"+window.configUrl.viewUrl+"/view/house/"+t[i].sKey+"/900x675."+t[i].sExt,s=e('<div class="image-item"><img src="'+n+'"><a class="images-del">x</a><a class="preview-image">预览</a></div>');e(".selectHouseImg-upload-wrapper").before(s)}}},complete:function(){a.loading.hide()}})}),e("#selectHouseSaleContractProofPic").on("click",function(){e("#selectHouseSaleContractProofPicInput").trigger("click")}),e("#selectHouseSaleContractProofPicInput").on("change",function(t){var i=new FormData,o=t.target.files||t.dataTransfer.files;for(var n in o)i.append("part"+n,o[n]);a.loading.open(),e.ajax({url:"http://"+window.configUrl.postPicsUrl+"/upload/house.html",type:"post",data:i,contentType:!1,processData:!1,cache:!1,success:function(t){if(t.code)return r.warn(t.file),!1;for(var i in t){var o={imgKey:t[i].sKey,imgExt:t[i].sExt};if(a.houseSaleContractProofPic.push(o),/^(png|jpe?g)$/.test(t[i].sExt)){var n="http://"+window.configUrl.viewUrl+"/view/house/"+t[i].sKey+"/900x675."+t[i].sExt,s=e('<div class="image-item"><img src="'+n+'"><a class="images-del">x</a><a class="preview-image">预览</a></div>');e(".selectHouseSaleContractProofPic-upload-wrapper").before(s)}}},complete:function(){a.loading.hide()}})}),e("#selectHouseDeliveryDescPic").on("click",function(){e("#selectHouseDeliveryDescPicInput").trigger("click")}),e("#selectHouseDeliveryDescPicInput").on("change",function(t){var i=new FormData,o=t.target.files||t.dataTransfer.files;for(var n in o)i.append("part"+n,o[n]);a.loading.open(),e.ajax({url:"http://"+window.configUrl.postPicsUrl+"/upload/house.html",type:"post",data:i,contentType:!1,processData:!1,cache:!1,success:function(t){if(t.code)return r.warn(t.file),!1;for(var i in t){var o={imgKey:t[i].sKey,imgExt:t[i].sExt};if(a.houseDeliveryDescPic.push(o),/^(png|jpe?g)$/.test(t[i].sExt)){var n="http://"+window.configUrl.viewUrl+"/view/house/"+t[i].sKey+"/900x675."+t[i].sExt,s=e('<div class="image-item"><img src="'+n+'"><a class="images-del">x</a><a class="preview-image">预览</a></div>');e(".selectHouseDeliveryDescPic-upload-wrapper").before(s)}}},complete:function(){a.loading.hide()}})}),e("#selectCredentialsImg").on("click",function(){e("#selectCredentialsImgInput").trigger("click")}),e("#selectCredentialsImgInput").on("change",function(t){var i=new FormData,o=t.target.files||t.dataTransfer.files;for(var n in o)i.append("part"+n,o[n]);a.loading.open(),e.ajax({url:"http://"+window.configUrl.postPicsUrl+"/upload/house.html",type:"post",data:i,contentType:!1,processData:!1,cache:!1,success:function(t){if(t.code)return r.warn(t.file),!1;for(var i in t){var o={imgKey:t[i].sKey,imgExt:t[i].sExt};if(a.propertyPic.push(o),/^(png|jpe?g)$/.test(t[i].sExt)){var n="http://"+window.configUrl.viewUrl+"/view/house/"+t[i].sKey+"/900x675."+t[i].sExt,s=e('<div class="image-item"><img src="'+n+'"><a class="images-del">x</a><a class="preview-image">预览</a></div>');e(".selectCredentialsImg-upload-wrapper").before(s)}}},complete:function(){a.loading.hide()}})}),e("#proxyPicImg").on("click",function(){e("#proxyPicImgInput").trigger("click")}),e("#proxyPicImgInput").on("change",function(t){var i=new FormData,o=t.target.files||t.dataTransfer.files;for(var n in o)i.append("part"+n,o[n]);a.loading.open(),e.ajax({url:"http://"+window.configUrl.postPicsUrl+"/upload/house.html",type:"post",data:i,contentType:!1,processData:!1,cache:!1,success:function(t){if(t.code)return r.warn(t.file),!1;for(var i in t){var o={imgKey:t[i].sKey,imgExt:t[i].sExt};if(a.proxyPic.push(o),/^(png|jpe?g)$/.test(t[i].sExt)){var n="http://"+window.configUrl.viewUrl+"/view/house/"+t[i].sKey+"/900x675."+t[i].sExt,s=e('<div class="image-item"><img src="'+n+'"><a class="images-del">x</a><a class="preview-image">预览</a></div>');e(".proxyPicImg-upload-wrapper").before(s)}}},complete:function(){a.loading.hide()}})})},delImg:function(){var a=this;e(".pre-selectOwnerImg").on("click",".images-del",function(){var t=e(this).parent(".image-item"),i=t.index();a.propertyIdCardPic.splice(i,1),e("#selectOwnerImg1Input").val(""),t.remove()}),e(".pre-selectHouseImg").on("click",".images-del",function(){var t=e(this).parent(".image-item"),i=t.index();a.pics.splice(i,1),e("#selectHouseImgInput").val(""),t.remove()}),e(".pre-selectCredentialsImg").on("click",".images-del",function(){var t=e(this).parent(".image-item"),i=t.index();a.propertyPic.splice(i,1),e("#selectCredentialsImgInput").val(""),t.remove()}),e(".pre-selectHouseSaleContractProofPic").on("click",".images-del",function(){var t=e(this).parent(".image-item"),i=t.index();a.houseSaleContractProofPic.splice(i,1),e("#selectHouseSaleContractProofPicInput").val(""),t.remove()}),e(".pre-selectHouseDeliveryDescPic").on("click",".images-del",function(){var t=e(this).parent(".image-item"),i=t.index();a.houseDeliveryDescPic.splice(i,1),e("#selectHouseDeliveryDescPicInput").val(""),t.remove()}),e(".pre-proxyPicImg").on("click",".images-del",function(){var t=e(this).parent(".image-item"),i=t.index();a.proxyPic.splice(i,1),e("#proxyPicImgInput").val(""),t.remove()})},hideContent:function(a){a?e(".hide-content").css("display","none"):e(".hide-content").css("display","block")},initMap:function(){var a=this,t=new BMap.Map("axg-map"),i=new BMap.Point(108.373029,22.822608);t.enableScrollWheelZoom(),t.enableContinuousZoom(),t.centerAndZoom(i,20);var o=new BMap.ScaleControl({anchor:BMAP_ANCHOR_TOP_LEFT}),n=new BMap.NavigationControl;t.addControl(o),t.addControl(n);var s=new BMap.Marker(i);t.addOverlay(s),s.enableDragging(),s.addEventListener("dragend",function(){});var c=new BMap.LocalSearch(t);c.enableAutoViewport(),e("#reSearch").on("click",function(){var e=document.getElementById("creAddress").value;if(""==e)return r.warn("请输入具体地址"),!1;t.clearOverlays();var i=new BMap.Geocoder;i.getPoint(e,function(e){if(e){a.config.postPoint={},a.config.postPoint=e,t.centerAndZoom(e,16);var i=new BMap.Marker(e);t.addOverlay(i),i.enableDragging(),i.addEventListener("dragend",function(){})}else r.warn("您选择地址没有解析到结果!")},a.config.city)})},bindEvents:function(){var a=this;e(".icon-close_ic").on("click",function(){e(".tip-wrapper").hide()}),e(".rightProofType").on("change",function(){a.rightProofTypeRely()}),e("body").on("click","#getHouseInfoBtn",function(){if(!e(".rightProofType").val())return r.warn("请选择所有权利证明类型",2e3),!1;if(!e(".ownerNum").val())return r.warn("请输入所有权利编号",2e3),!1;e(".get-houseInfo-btn").css("background","#E1E1E1").attr("disabled","disabled"),a.hideContent(!1);var t={propertyRightCardNo:a.firstOwnerNum,propertyRightName:a.firstOwnerName,rightProofType:e(".rightProofType option:checked").attr("rightprooftypeindex"),propertyRightNo:e(".ownerNum").val()};e.ajax({url:window.configUrl.getHouseInfoUrl,contentType:"application/json; charset=UTF-8",type:"post",data:JSON.stringify(t),dataType:"json",success:function(t){if(t.success){if(t.data.houseNumber){if(a.projectName=t.data.projectName,a.street=t.data.street,e(".fail-tip").hide(),e(".success-tip").show(),a.houseNumber=t.data.houseNumber,a.locationName=t.data.locationName,e("#owner").children("div").eq(0).siblings("div").remove(),a.config.ownerIndex=2,t.data.govCrpInfos&&t.data.govCrpInfos.length>0){e(".crpStatus").find("input[value=1]").attr("checked","checked"),a.isTake=!1,a.crpInfo=t.data.govCrpInfos;for(var i=0;i<a.crpInfo.length;i++)a.crpInfo[i].idcard=a.crpInfo[i].propertyRightCardNo,a.crpInfo[i].name=a.crpInfo[i].propertyRightName,a.crpInfo[i].pics=[],a.crpInfo[i].propertyRightNo=a.crpInfo[i].propertyRightNo,a.crpInfo[i].rightProofType=a.crpInfo[i].propertyType,a.crpInfo[i].mobile=a.crpInfo[i].propertyRightMobile;for(var i=0;i<t.data.govCrpInfos.length;i++)e("#addOwner").trigger("click"),e(".container-top-rightProofType").css("display","none"),e(".owner-wrapper").eq(i).find(".rightProofType-crp").find("option[rightprooftypeindex="+t.data.govCrpInfos[i].rightProofType+"]").attr("selected","selected"),e(".owner-wrapper").eq(i).find(".propertyrightno").val(t.data.govCrpInfos[i].propertyRightNo),e(".owner-wrapper").eq(i).find(".ownerInputName").val(t.data.govCrpInfos[i].propertyRightName),e(".owner-wrapper").eq(i).find(".ownerInputNum").val(t.data.govCrpInfos[i].propertyRightCardNo),e(".owner-wrapper").eq(i).find(".ownerInputMobile").val(t.data.govCrpInfos[i].propertyRightMobile),i==t.data.govCrpInfos.length-1&&(a.isTake=!0);e(".delete-wrapper").hide()}e(".rightProofType-crp").attr("disabled","disabled"),e(".propertyrightno").attr("disabled","disabled"),e(".ownerInputName").attr("disabled","disabled"),e(".ownerInputNum").attr("disabled","disabled"),e(".commonPropertyRadio").css("display","none"),e(".buildingNo").val(t.data.geteNo),t.data.geteNo&&e(".buildingNo").attr("disabled","disabled"),e(".unitNo").val(t.data.buildingNo),t.data.buildingNo&&e(".unitNo").attr("disabled","disabled"),e(".roomNo").val(t.data.roomNo),t.data.roomNo&&e(".roomNo").attr("disabled","disabled"),e(".houseSpace").val(t.data.houseSpace/100),e(".houseSpace").attr("disabled","disabled"),e(".space").val(t.data.space/100),e(".space").attr("disabled","disabled"),e(".address-detail").val(t.data.houseLocation),e(".address-detail").attr("disabled","disabled"),e(".natureLand").find("option[naturelandindex="+t.data.natureLand+"]").attr("selected","selected"),-1!=t.data.natureLand&&e(".natureLand").attr("disabled","disabled"),null!==t.data.govCrpInfo&&t.data.govCrpInfo.propertyType&&(e(".propertyType").find("option[value="+t.data.govCrpInfo.propertyType+"]").attr("selected","selected"),e(".propertyType").attr("disabled","disabled")),e(".rightProofType").attr("disabled","disabled"),e(".ownerNum").attr("disabled","disabled"),t.data.govCrpInfos&&t.data.govCrpInfos.length>0&&e(".proxy").show()}}else e(".success-tip").hide(),e(".fail-tip").show(),e(".get-houseInfo-btn").css("background","#309de5").removeAttr("disabled")},error:function(){e(".success-tip").hide(),e(".fail-tip").show(),e(".get-houseInfo-btn").css("background","#309de5").removeAttr("disabled")}})}),e(".roomNum").on("blur",function(){e(this).val()>=1&&e(this).val()<=20||(r.warn("户型必须在1-20之间"),e(this).val(""))}),e(".hallNum").on("blur",function(){e(this).val()>=0&&e(this).val()<=20||(r.warn("户型必须在0-20之间"),e(this).val(""))}),e(".toiletNum").on("blur",function(){e(this).val()>=0&&e(this).val()<=20||(r.warn("户型必须在0-20之间"),e(this).val(""))}),e(".houseSpace").on("blur",function(){var a=e(".space").val();""==e(this).val()?(r.warn("套内面积不能为空"),e(this).val("")):""!=a?parseFloat(e(this).val())>parseFloat(a)&&(r.warn("套内面积应小于等于建筑面积"),e(this).val("")):(r.warn("建筑面积不能为空"),e(this).val(""))}),e(".natureLand").on("change",function(){var a=e("option:selected",".natureLand").attr("naturelandindex");1==a?e(".J_natureLand_change").removeClass("hide"):e(".J_natureLand_change").addClass("hide")}),e.ajax({url:window.configUrl.userInfo,type:"get",dataType:"json",success:function(t){t.success?t.data.identityCardFrontKey&&t.data.identityCardBackKey?(""==window.configUrl.id&&a.openNotice(),a.firstOwnerName=t.data.name,a.firstOwnerNum=t.data.identity,e(".firstOwnerName").html(t.data.name),e(".firstOwnerNum").html(t.data.identity)):e("#check_modal").dialog("instance").open():console.log(t.code)}}),Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)}),e(".villageBtn").on("click",function(){e(".select-village-wrapper").dialog("instance").open()}),e(".select-village-wrapper").on("click",".close-btn",function(){e("#select-village").dialog("instance").close()}),e(".editVillage").on("keyup",function(){e.ajax({url:window.configUrl.suggestUrl,type:"get",data:{name:e(".editVillage").val()},dataType:"json",success:function(t){if(a.communityId="",0==t.errorCode)if(e(".list-ul").children().remove(),0!=t.data.total&&t.data.list){a.liArr.splice(0,a.liArr.length);for(var i=0;i<t.data.list.length;i++){var r="<li><p>"+t.data.list[i].communityName+"</p><span>"+t.data.list[i].communityId+"</span></li>";a.liArr.push(r)}e(".list-ul").append(a.liArr).show()}else 0==t.data.total&&(a.liArr.splice(0,a.liArr.length),e(".list-ul").hide())}})}),e(".list-ul").on("click","li",function(){a.communityId="";var t=e(this).find("span").html();a.communityId=t;var i=e(this).find("p").html();e(".editVillage").val(i),e(".list-ul").children().remove(),a.liArr.splice(0,a.liArr.length),e(".list-ul").hide()}),e("#click_create").on("click",function(){e("#create-village").dialog("instance").open(),e("#select-village").dialog("instance").close(),a.initMap(),e.ajax({url:window.configUrl.cityUrl,type:"get",dataType:"json",success:function(a){if(a.success){var t=a.data.district,i=a.data.block;for(var r in t){var o='<option districtId="'+t[r].id+'" blockId="'+i[r][0].id+'">'+t[r].name+"</option>";e(".creArea").append(o)}}else console.log(a.code)}})}),e(".create-village-wrapper").on("click",".close-btn",function(){e(".creArea").text(""),e(".creArea").append('<option value="">请选择</option>'),e("#create-village").dialog("instance").close(),e("#select-village").dialog("instance").open()}),e(".create-village-wrapper").on("click",".addBtn",function(){if(""==e(".creVillage").val().trim())r.warn("请填写小区");else if("0"==e("option:selected",".creArea").index())r.warn("请选择区域");else if(""==e("#creAddress").val().trim())r.warn("请填写具体地址");else if("{}"==JSON.stringify(a.config.postPoint))r.warn("请点击搜索以确定位置");else{var t={name:e(".creVillage").val(),address:e("#creAddress").val(),latitude:a.config.postPoint.lat,longitude:a.config.postPoint.lng,blockId:e("option:selected",".creArea").attr("blockId"),districtId:e("option:selected",".creArea").attr("districtId")};e.ajax({url:window.configUrl.createVillageUrl,type:"post",contentType:"application/json; charset=UTF-8",data:JSON.stringify(t),dataType:"json",success:function(a){a.success?(r.success("新建小区成功，请等待审核"),e("#create-village").dialog("instance").close(),e("#select-village").dialog("instance").close()):r.warn(a.msg)}})}}),e(".create-village-wrapper").on("click",".calBtn",function(){e(".creArea").text(""),e(".creArea").append('<option value="">请选择</option>'),e("#create-village").dialog("instance").close(),e("#select-village").dialog("instance").open()}),e("#select-village").on("click",".addBtn",function(){var t=e(".editVillage").val().replace(/\s+/g,"");""==t||""==a.communityId?(e(".editVillage").focus().val(""),r.warn("选择一个小区")):(e(".villageProcess").hide(),e(".villageAddressText").html(t),e(".villageAddress").show(),e("#select-village").dialog("instance").close(),e("#villageBtn").html("修改小区"))}).on("click",".calBtn",function(){e("#select-village").dialog("instance").close()}),e("#closeTips").on("click",function(){e(".smallTip").hide()}),e(".back").on("click",function(){window.history.back(-1)}),e("input:radio[name='ownerOne']").change(function(){e("#ownerIsOverOne").is(":checked")?(e(this).attr("checked","checked"),e(this).siblings().removeAttr("checked"),e("#addOwner").show(),e("#owner-wrapper").siblings().show(),e(".proxy").show()):e("#ownerIsOne").is(":checked")&&(e(this).attr("checked","checked"),e(this).siblings().removeAttr("checked"),e("#addOwner").hide(),e("#owner-wrapper").siblings().hide(),e(".proxy").hide())}),e(".owner-msg").on("change",".rightProofType-crp",function(){var t=e(this).parent().parent().parent().parent().parent().index()-1;a.crpInfo[t].rightProofType=e(this).find("option:checked").attr("rightprooftypeindex")}),e(".owner-msg").on("change",".propertyrightno",function(){var t=e(this).parent().parent().parent().parent().index()-1;a.crpInfo[t].propertyRightNo=e(this).val()}),e(".owner-msg").on("change",".ownerInputName",function(){var t=e(this).parent().parent().parent().parent().index()-1;a.crpInfo[t].name=e(this).val()}),e(".owner-msg").on("change",".ownerInputNum",function(){var t=e(this).parent().parent().parent().parent().index()-1;a.crpInfo[t].idcard=e(this).val()}),e(".owner-msg").on("change",".ownerInputMobile",function(){var t=e(this).parent().parent().parent().parent().index()-1;a.crpInfo[t].mobile=e(this).val()}),e("#download_proxyPic").on("click",function(){e.ajax({url:"/web/goverp/api/attachment",type:"get",dataType:"json",success:function(e){if(e.success){var a=e.data.proxyDownUrl;window.open(a)}else console.log(e.code)}})}),e(".sub").on("click",function(){if(!n){var t=[],i=[],o=[],s=0,c=0,l=0,p=e(".tags input[type='checkbox']"),d=e(".collocation input[type='checkbox']"),u=e(".landlordRequest input[type='checkbox']");for(s in p)p[s].checked&&t.push(p.eq(s).attr("housetagindex"));for(c in d)d[c].checked&&i.push(d.eq(c).attr("housecollocationindex"));for(l in u)u[l].checked&&o.push(u.eq(l).attr("landlordrequestindex"));var g=parseInt(e(".crpStatus input[name='ownerOne']:checked").val()),f={houseNumber:a.houseNumber||"",houseLocation:e(".address-detail").val(),houseDistrict:a.locationName||"",rightProofType:e(".rightProofType option:checked").attr("rightprooftypeindex"),houseSaleContractProofPic:a.houseSaleContractProofPic||[],houseDeliveryDescPic:a.houseDeliveryDescPic||[],propertyRightName:a.firstOwnerName,propertyRightCardNo:a.firstOwnerNum,propertyIdCardPic:a.propertyIdCardPic||[],communityId:a.communityId,communityName:e(".villageAddressText").text(),projectName:a.projectName,street:a.street,buildingNo:e(".buildingNo").val(),unitNo:e(".unitNo").val(),roomNo:e(".roomNo").val(),inFloor:parseInt(e(".inFloor").val()),totalFloor:parseInt(e(".totalFloor").val()),roomNum:parseInt(e(".roomNum").val()),hallNum:parseInt(e(".hallNum").val()),toiletNum:parseInt(e(".toiletNum").val()),space:parseInt(100*e(".space").val()),houseSpace:parseInt(100*e(".houseSpace").val()),situation:e("option:selected",".situation").attr("situationindex"),toward:e("option:selected",".toward").attr("towardIndex"),tags:t,collocation:i,landlordRequest:o,desc:e(".desc").val(),rentPrice:parseInt(100*e(".rentMoney").val()),paymentWay:e("option:selected",".paymentWay").attr("paymentwayindex"),rentType:e("option:selected",".rentType").attr("renttypeindex"),rentPosition:e(".rentPosition").val(),mobile:e(".contactPhone").val(),propertyRightNo:e(".ownerNum").val(),natureLand:e("option:selected",".natureLand").attr("naturelandindex"),crpStatus:g,crpInfo:0===g?null:a.crpInfo,pics:a.pics,propertyPic:a.propertyPic,commonOwnerOpinion:a.proxyPic,sourceType:3,id:window.configUrl.id||"",propertyType:e(".propertyType option:checked").attr("value")};if(""==e(".ownerNum").val())return r.warn("请填写所有权证号"),!1;if(""==e(".natureLand").val())return r.warn("请选择房屋用途"),!1;if(""==e(".propertyType").val())return r.warn("请选择权利类型"),!1;if(f.crpInfo)for(var c=0;c<f.crpInfo.length;c++)if((""==f.crpInfo[c].rightProofType||0===f.crpInfo[c].pics.length||""==f.crpInfo[c].propertyRightNo||""==f.crpInfo[c].name||""==f.crpInfo[c].idcard||""==f.crpInfo[c].mobile)&&1==f.crpStatus)return r.warn("请填写完整共有权利人信息"),!1;if(f.pics.length<3)return r.warn("请上传至少三张房源图片"),!1;if((1==f.rightProofType||4==f.rightProofType)&&!f.propertyPic.length)return r.warn("请上传产权证图片"),!1;if((2==f.rightProofType||3==f.rightProofType)&&!f.houseSaleContractProofPic.length)return r.warn("请上传商品房买卖合同登记备案证明"),!1;if(f.crpStatus&&!f.commonOwnerOpinion.length)return r.warn("请上传共有人同意出租意见书"),!1;if(""==e(".unitNo").val())return r.warn("请填写房源单元号"),!1;if(f.inFloor&&parseInt(f.inFloor)<-5)return r.warn("所在楼层不能小于-5"),!1;if("1"===f.natureLand){if(!f.inFloor||!f.totalFloor)return r.warn("请填写楼层"),!1;if(""===f.roomNum||""===f.hallNum||""===f.toiletNum)return r.warn("请填写完整户型"),!1;if(!f.situation)return r.warn("请选择装修类型"),!1}if(void 0==f.rentType)return r.warn("请选择出租方式"),!1;var m=e(".space").val(),v=e(".houseSpace").val();return""==v?(r.warn("套内面积不能为空"),e(".houseSpace").val(""),!1):""==m?(r.warn("建筑面积不能为空"),e(".houseSpace").val(""),!1):parseFloat(v)>parseFloat(m)?(r.warn("套内面积小于等于建筑面积"),e(".houseSpace").val(""),!1):void a.housePublish(f)}}),e(".contain-main").on("mouseover mouseout",".pre .image-item",function(){"mouseover"==event.type?e(this).find(".preview-image").show():"mouseout"==event.type&&e(this).find(".preview-image").hide()}),e(".contain-main").on("click",".pre .preview-image",function(){e(".big-wrap").show();var a=e(this).parent(".image-item").find("img").attr("src");e(".big-wrap").find("img").attr("src",a)}),e(".close-wrap").on("click",function(){e(".big-wrap").hide()})},openNotice:function(){e("#container-notice").dialog("instance").open(),e("#container-notice").on("click",".close-btn",function(){return e("#hasRead").is(":checked")?void e("#container-notice").dialog("instance").close():void r.warn("请确认已阅读内容！",3e3)}),e("#J_NoticeBtn").off("click").on("click",function(){return e("#hasRead").is(":checked")?void e("#container-notice").dialog("instance").close():void r.warn("请确认已阅读内容！",3e3)})},housePublish:function(a){n=!0,e.ajax(""!=window.configUrl.id?{url:window.configUrl.houseEditFormUrl+window.configUrl.id,contentType:"application/json; charset=UTF-8",type:"POST",data:JSON.stringify(a),dataType:"json",success:function(e){e.success?(r.success("修改房源成功"),setTimeout(function(){location.href="/pc/publishHouse/list"},300)):(n=!1,r.warn(null!=e.fieldErrors?e.fieldErrors[0].msg:e.msg))}}:{url:window.configUrl.houseFormUrl,type:"post",contentType:"application/json; charset=UTF-8",data:JSON.stringify(a),dataType:"json",success:function(e){e.success?(r.success("发房成功"),setTimeout(function(){location.href="/pc/publishHouse/list"},300)):(n=!1,r.warn(null!=e.fieldErrors?e.fieldErrors[0].msg:e.msg))}})},editForm:function(a){var t=this;e.ajax({url:window.configUrl.houseFormUrl+"/"+a,type:"get",data:{id:a},success:function(a){if(a.success){t.hideContent(!1),e(".rightProofType").get(0).selectedIndex=a.data.rightProofType,t.rightProofTypeRely(),t.houseNumber=a.data.houseNumber,t.locationName=a.data.houseDistrict,e(".villageAddress").show(),e(".propertyType").find("option[value="+a.data.rightProofType+"]").attr("selected","selected"),e("#villageBtn").html("修改小区"),t.communityId=a.data.communityId,e(".villageAddressText").html(a.data.communityName),e(".buildingNo").val(a.data.buildingNo),e(".unitNo").val(a.data.unitNo),e(".roomNo").val(a.data.roomNo),e(".inFloor").val(null!==a.data.inFloor?a.data.inFloor:""),e(".totalFloor").val(null!==a.data.totalFloor?a.data.totalFloor:""),e(".roomNum").val(a.data.roomNum),e(".hallNum").val(a.data.hallNum),e(".toiletNum").val(a.data.toiletNum),e(".space").val(a.data.space/100),e(".houseSpace").val(a.data.houseSpace/100),e(".situation").find("option[situationindex="+a.data.situation+"]").attr("selected","selected"),e(".toward").find("option[towardindex="+a.data.toward+"]").attr("selected","selected");for(var i=0;i<a.data.tags.length;i++)e(".tags").find("input[housetagindex="+a.data.tags[i]+"]").attr("checked","checked");for(var i=0;i<a.data.collocation.length;i++)e(".collocation").find("input[housecollocationindex="+a.data.collocation[i]+"]").attr("checked","checked");for(var i=0;i<a.data.landlordRequest.length;i++)e(".landlordRequest").find("input[landlordRequestindex="+a.data.landlordRequest[i]+"]").attr("checked","checked");e(".desc").val(a.data.desc),e(".rentMoney").val(a.data.rentPrice/100),e(".paymentWay").find("option[paymentwayindex="+a.data.paymentWay+"]").attr("selected","selected"),e(".rentType").find("option[renttypeindex="+a.data.rentType+"]").attr("selected","selected"),e(".contactPhone").val(a.data.mobile),e(".address-detail").val(a.data.houseLocation),e(".ownerNum").val(a.data.propertyRightNo),e(".natureLand").find("option[naturelandindex="+a.data.natureLand+"]").attr("selected","selected"),e(".crpStatus").find("input[value="+a.data.crpStatus+"]").attr("checked","checked"),t.propertyIdCardPic=a.data.propertyIdCardPic||[];
for(var i=0;i<a.data.propertyIdCardPic.length;i++){var o="http://"+window.configUrl.viewUrl+"/view/house/"+t.propertyIdCardPic[i].imgKey+"/900x675."+t.propertyIdCardPic[i].imgExt,n=e('<div class="image-item"><img src="'+o+'"><a class="images-del">x</a><a class="preview-image">预览</a></div>');e(".owner-upload-wrapper").before(n)}t.houseSaleContractProofPic=a.data.houseSaleContractProofPic||[];for(var i=0;i<a.data.houseSaleContractProofPic.length;i++){var o="http://"+window.configUrl.viewUrl+"/view/house/"+t.houseSaleContractProofPic[i].imgKey+"/900x675."+t.houseSaleContractProofPic[i].imgExt,n=e('<div class="image-item"><img src="'+o+'"><a class="images-del">x</a><a class="preview-image">预览</a></div>');e(".selectHouseSaleContractProofPic-upload-wrapper").before(n)}t.houseDeliveryDescPic=a.data.houseDeliveryDescPic||[];for(var i=0;i<a.data.houseDeliveryDescPic.length;i++){var o="http://"+window.configUrl.viewUrl+"/view/house/"+t.houseDeliveryDescPic[i].imgKey+"/900x675."+t.houseDeliveryDescPic[i].imgExt,n=e('<div class="image-item"><img src="'+o+'"><a class="images-del">x</a><a class="preview-image">预览</a></div>');e(".selectHouseDeliveryDescPic-upload-wrapper").before(n)}if(1==a.data.crpStatus){e("#addOwner").show(),e(".proxy").show(),t.proxyPic=a.data.commonOwnerOpinion;for(var i=0;i<a.data.commonOwnerOpinion.length;i++){var o="http://"+window.configUrl.viewUrl+"/view/house/"+t.proxyPic[i].imgKey+"/900x675."+t.proxyPic[i].imgExt,n=e('<div class="image-item"><img src="'+o+'"><a class="images-del">x</a><a class="preview-image">预览</a></div>');e(".proxyPicImg-upload-wrapper").before(n)}if(a.data.crpInfo.length>0){t.isTake=!1,t.crpInfo=a.data.crpInfo;for(var s=0;s<a.data.crpInfo.length;s++){e("#addOwner").trigger("click"),e(".owner-wrapper").eq(s).find(".rightProofType-crp").find("option[rightprooftypeindex="+a.data.crpInfo[s].rightProofType+"]").attr("selected","selected"),e(".owner-wrapper").eq(s).find(".propertyrightno").val(a.data.crpInfo[s].propertyRightNo),e(".owner-wrapper").eq(s).find(".ownerInputName").val(a.data.crpInfo[s].name),e(".owner-wrapper").eq(s).find(".ownerInputNum").val(a.data.crpInfo[s].idcard),e(".owner-wrapper").eq(s).find(".ownerInputMobile").val(a.data.crpInfo[s].mobile);for(var c=0;c<a.data.crpInfo[s].pics.length;c++){var o="http://"+window.configUrl.viewUrl+"/view/house/"+a.data.crpInfo[s].pics[c].imgKey+"/900x675."+a.data.crpInfo[s].pics[c].imgExt,n=e('<div class="image-item"><img src="'+o+'"><a class="images-del">x</a><a class="preview-image">预览</a></div>');e(".owner-upload-wrapper"+parseInt(s+1)).before(n)}s==a.data.crpInfo.length-1&&(t.isTake=!0)}}}t.pics=a.data.pics,console.log(a.data.pics.length+" abc");for(var i=0;i<a.data.pics.length;i++){var o="http://"+window.configUrl.viewUrl+"/view/house/"+t.pics[i].imgKey+"/900x675."+t.pics[i].imgExt,n=e('<div class="image-item"><img src="'+o+'"><a class="images-del">x</a><a class="preview-image">预览</a></div>');e(".selectHouseImg-upload-wrapper").before(n)}t.propertyPic=a.data.propertyPic;for(var i=0;i<a.data.propertyPic.length;i++){var o="http://"+window.configUrl.viewUrl+"/view/house/"+t.propertyPic[i].imgKey+"/900x675."+t.propertyPic[i].imgExt,n=e('<div class="image-item"><img src="'+o+'"><a class="images-del">x</a><a class="preview-image">预览</a></div>');e(".selectCredentialsImg-upload-wrapper").before(n)}1==a.data.govSucc&&(e(".get-houseInfo-btn").css("background","#E1E1E1").removeAttr("id"),e(".propertyType").attr("disabled","disabled"),e(".houseSpace").attr("disabled","disabled"),e(".space").attr("disabled","disabled"),e(".address-detail").attr("disabled","disabled"),-1!=a.data.natureLand&&e(".natureLand").attr("disabled","disabled"),e(".rightProofType").attr("disabled","disabled"),e(".ownerNum").attr("disabled","disabled"),e(".delete-wrapper").hide(),e(".rightProofType-crp").attr("disabled","disabled"),e(".propertyrightno").attr("disabled","disabled"),e(".ownerInputName").attr("disabled","disabled"),e(".ownerInputNum").attr("disabled","disabled"),a.data.crpInfo.length>0&&e(".commonPropertyRadio").css("display","none"),e(".buildingNo").val(a.data.buildingNo),a.data.buildingNo&&e(".buildingNo").attr("disabled","disabled"),e(".unitNo").val(a.data.unitNo),a.data.unitNo&&e(".unitNo").attr("disabled","disabled"),e(".roomNo").val(a.data.roomNo),a.data.roomNo&&e(".roomNo").attr("disabled","disabled"))}else r.warn("带入数据失败")}})},imgUpload:function(a){var t=this,i=a-1;e("#selectOwnerImg1Input"+a).on("change",function(o){var n=new FormData,s=o.target.files||o.dataTransfer.files;for(var c in s)n.append("part"+c,s[c]);t.loading.open(),e.ajax({url:"http://"+window.configUrl.postPicsUrl+"/upload/house.html",type:"post",data:n,contentType:!1,processData:!1,cache:!1,success:function(o){if(o.code)return r.warn(o.file),!1;for(var n in o){if(t.crpInfo[i]&&t.crpInfo[i].pics[0]&&t.crpInfo[i].pics[0].imgKey){if(2==t.crpInfo[i].pics.length)return void r.warn("只能上传两张图片！");if(t.crpInfo[i].pics[0].imgKey==o[n].sKey)return void r.warn("请不要上传相同的图片！")}{var s={imgKey:o[n].sKey,imgExt:o[n].sExt};Array.isArray(t.crpInfo[i].pics)?t.crpInfo[i].pics:[]}if(t.crpInfo[i].pics=Array.isArray(t.crpInfo[i].pics)?t.crpInfo[i].pics:[],t.crpInfo[i].pics.push(s),/^(png|jpe?g)$/.test(o[n].sExt)){e("#selectOwnerImg1Input"+a).val("");var c="http://"+window.configUrl.viewUrl+"/view/house/"+o[n].sKey+"/900x675."+o[n].sExt,l=e('<div class="image-item"><img src="'+c+'"><a class="images-del">x</a><a class="preview-image">预览</a></div>');e(".owner-upload-wrapper"+a).before(l)}}},complete:function(){t.loading.hide()}})})},imgDelete:function(a){var t=this,i=a-1;e(".pre-selectOwnerImg").on("click",".images-del",function(){var a=e(this).parent(".image-item"),r=a.index();e(this).parent().parent().find("input").val(""),t.crpInfo[i].pics.splice(r,1),a.remove()})}};s.init()})});