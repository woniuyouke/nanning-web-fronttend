define("web:static/member/findPwd/index.js",function(t){"use strict";t.async(["common:components/jquery/jquery.js","common:components/pcUI/dialog/dialog.js","common:components/pcUI/tips/tips.js","common:components/jsencrypt/jsencrypt.js","common:components/publickey/publickey.js"],function(t,e,s,a,i){var c,r={config:{baseValidateUrl:"/web/account/forget/base",sendMsgCaptchaUrl:"/web/account/forget/msgcode",imgCaptchaUrl:"/web/account/imgcode",validateUrl:"/web/account/forget/msgcodevlidate",submitUrl:"/web/account/reset",sNextStep:myHeader.config.loginUrl},init:function(){this.bindEvent()},bindEvent:function(){var e=this;t("#J_next").click(function(){if(!t(this).hasClass("disabled")){if(!e.formValidIdentity())return;t(this).addClass("disabled"),e.next()}}),t("#J_validate").click(function(){var s=t("#msgCaptcha").val().trim();if(!t(this).hasClass("disabled")){if(""==s)return void t("#J_set_step2 .error-msg").html("请输入短信验证码！");t(this).addClass("disabled"),e.validate()}}),t("#J_submit").click(function(){if(!t(this).hasClass("disabled")){if(!e.formValidPwd())return;t(this).addClass("disabled"),e.submit()}}),t("#J_regcode_img,#J_regcode_btn").on("click",function(){var s=e.config.imgCaptchaUrl+"?random="+Math.random();t("#J_regcode_img").attr("src",s)}),t("#J_regcode_img").trigger("click"),t("#J_send_captcha").on("click",function(){t(this).hasClass("disabled")||e.sendCaptchaAjax()})},submit:function(){var e=this,a=new JSEncrypt;a.setKey(i);var c={identity:t("#IDCard").val().trim(),checkPassword:a.encrypt(t("#sConfirmPwd").val().trim()),password:a.encrypt(t("#sPwd").val().trim())};t.ajax({url:e.config.submitUrl,type:"POST",contentType:"application/json;charset=utf-8",data:JSON.stringify(c),success:function(a){t("#J_submit").removeClass("disabled"),a.success?(console.log("忘记密码设置成功"),s.show("重置成功"),e.activeClockToBack()):t("#J_set_step3 .error-msg").html(a.msg)},error:function(){t("#J_submit").removeClass("disabled"),s.show("接口获取失败！")}})},formValidPwd:function(){var e=t("#sPwd").val().trim(),s=t("#sConfirmPwd").val().trim();return""==e||/[\u4E00-\u9FA5\uF900-\uFA2D]/.test(e)||/[\uFF00-\uFFEF]/.test(e)||!/^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]{6,15}$/.test(e)?void t("#J_set_step3 .error-msg").html("密码最短6位且包含字母和数字！"):e!=s?void t("#J_set_step3 .error-msg").html("两次输入密码不一致！"):!0},sendCaptchaAjax:function(){var e=this,a={identity:t("#IDCard").val().trim(),imgAuthCode:t("#imgCaptcha").val()};t.ajax({url:e.config.sendMsgCaptchaUrl,type:"POST",contentType:"application/json;charset=utf-8",data:JSON.stringify(a),success:function(s){t("#J_send_captcha").removeClass("disabled"),s.success?e.activeClock():(t("#J_set_step2 .error-msg").html(s.msg),t("#J_regcode_img").trigger("click"))},error:function(){t("#J_send_captcha").removeClass("disabled"),s.show("接口获取失败！")}})},formValidIdentity:function(){var e=t("#imgCaptcha").val().trim(),s=t("#IDCard").val().trim();return""!=s&&/^(?:\d{14}|\d{17})[\dx]$/i.test(s)?""==e?void t("#J_set_step1 .error-msg").html("请输入图形验证码！"):!0:void t("#J_set_step1 .error-msg").html("请输入正确的身份证号！")},next:function(){var e=this,a={identity:t("#IDCard").val().trim(),imgAuthCode:t("#imgCaptcha").val()};t.ajax({url:e.config.baseValidateUrl,type:"POST",contentType:"application/json;charset=utf-8",data:JSON.stringify(a),success:function(s){t("#J_next").removeClass("disabled"),s.success?(t("#J_msg_mobile").text(s.data.mobile),t("#J_set_step1").addClass("hide"),t("#J_next").addClass("hide"),t("#J_set_step2").removeClass("hide"),t("#J_validate").removeClass("hide"),t("#J_send_captcha").addClass("disabled"),e.activeClock()):(t("#J_set_step1 .error-msg").html(s.msg),t("#J_regcode_img").trigger("click"))},error:function(){t("#J_next").removeClass("disabled"),s.show("接口获取失败！")}})},validate:function(){var e=this,a={identity:t("#IDCard").val().trim(),msgCode:t("#msgCaptcha").val().trim()};t.ajax({url:e.config.validateUrl,type:"POST",contentType:"application/json;charset=utf-8",data:JSON.stringify(a),success:function(e){t("#J_validate").removeClass("disabled"),e.success?(t("#J_set_step2").addClass("hide"),t("#J_set_step3").removeClass("hide")):t("#J_set_step2 .error-msg").html(e.msg)},error:function(){t("#J_validate").removeClass("disabled"),s.show("接口获取失败！")}})},activeClock:function(){function e(){s?t("#J_send_captcha").text("重新获取"+s--+"s"):(t("#J_send_captcha").text("重新获取").removeClass("disabled"),clearInterval(c))}clearInterval(c);var s=60;e(),c=setInterval(e,1e3)},activeClockToBack:function(){clearInterval(c);var e=2;c=setInterval(function(){e?t("#J_second").text(e--):(location.href="/pc/user/login",clearInterval(c))},1e3)}};r.init()})});