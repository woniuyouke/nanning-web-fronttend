define("web:widget/login/login.js",function(e){"use strict";e.async(["common:components/jquery/jquery.js","common:components/pcUI/dialog/dialog.js","common:components/jsencrypt/jsencrypt.js","common:components/publickey/publickey.js"],function(e,r,t,o){var i={config:{sBaseInfoUrl:"/web/account/C/baseinfoC",sLoginUrl:"/web/account/login",sGetImgUrl:"",baseInfoUrl:"/web/account/registerFirst",setPwdUrl:"/web/account/reset/login",codeLoginUrl:"/web/account/codeLogin",msgCodeUrl:"/web/account/msgcodewithoutimgcode"},timer:{getCode:null,registerGetCode:null},init:function(){var e=this;e.bindEvent()},bindEvent:function(){var r=this;e("#J_login-dialog-wrapper").dialog({customWraper:!0}),e("#J_register-dialog-wrapper").dialog({customWraper:!0}),e(".J_show_dialog").on("click",function(){var t=e(this).data("dialog");"login"==t?(e("#J_register-dialog-wrapper").dialog("instance").close(),e("#J_login-dialog-wrapper").dialog("instance").open()):"register"==t&&(e("#J_login-dialog-wrapper").dialog("instance").close(),e("#J_register-dialog-wrapper").dialog("instance").open()),r.resetBtn()}),e(document).on("click","#J_login-dialog-wrapper .J_close",function(){e("#J_login-dialog-wrapper").dialog("instance").close(),r.resetBtn()}),e(document).on("click","#J_register-dialog-wrapper .J_close",function(){e("#J_register-dialog-wrapper").dialog("instance").close(),r.resetBtn()}),e(document).on("click","#J_login_btn",function(){r.formValid()&&r.login()}),e(".switch").on("click",function(){e("#accountLoginWrap").hasClass("hide")?(e("#accountLoginWrap").removeClass("hide"),e("#codeLoginWrap").addClass("hide")):(e("#accountLoginWrap").addClass("hide"),e("#codeLoginWrap").removeClass("hide"))}),e("#getCode").on("click",function(){if(!e(this).hasClass("disabled")){var t=e("#sLoginMobile").val().trim();if(!t)return void e(".error-msg-code").text("请输入手机号！");e(".error-msg-code").text(""),r.sendCode(t,4,function(t){t.success?(r.countDown("getCode"),e("#getCode").data("serialNo","")):e(".error-msg-code").text(t.fieldErrors&&t.fieldErrors.length>0?t.fieldErrors[0].msg:t.msg)})}}),e("#J_code_login_btn").on("click",function(){r.isValid()&&r.authLogin()}),e("#imgAuth").on("click",function(){r.refreshImg()}),e("#registerGetCode").on("click",function(){if(!e(this).hasClass("disabled")){var t=e("#phoneNumber").val().trim();if(!t)return void e(".error-msg-registry").text("请输入手机号！");e(".error-msg-registry").text(""),r.sendCode(t,1,function(t){return t.success?(r.countDown("registerGetCode"),void e("#registerGetCode").data("serialNo","")):void e(".error-msg-registry").text(t.fieldErrors&&t.fieldErrors.length>0?t.fieldErrors[0].msg:t.msg)})}}),e("#nextStep").on("click",function(){var t=e("#idNo").val().trim(),o=e("#phoneNumber").val().trim(),i=e("#msgCode").val().trim(),s=e("#realName").val().trim();return""==s?void e(".error-msg-registry").text("姓名不能为空"):""==t?void e(".error-msg-registry").text("身份证不能为空"):""==o?void e(".error-msg-registry").text("手机号不能为空"):""==i?void e(".error-msg-registry").text("验证码不能为空"):(e(".error-msg-registry").empty(),void r.submitBaseInfo(function(r){r.success?(e(".step1").addClass("hide"),e(".step2").removeClass("hide"),e("#nextStep").hide(),e("#submit-registry").show(),e(".error-msg-registry").empty()):e(".error-msg-registry").text(r.fieldErrors&&r.fieldErrors.length>0?r.fieldErrors[0].msg:r.msg)}))}),e("#submit-registry").on("click",function(){var t={};r.validatePwd()&&(t.password=e("#pwd").val(),t.checkPassword=e("#pwd2").val(),e.ajax({url:r.config.setPwdUrl,type:"POST",contentType:"application/json;charset=utf-8",data:JSON.stringify(t),success:function(r){r.success?(e(".J_show_dialog").trigger("click"),e(".error-msg-registry").empty(),e(".step1").removeClass("hide"),e(".step2").addClass("hide")):r.fieldErrors&&r.fieldErrors.length>0?e(".error-msg-registry").text(r.fieldErrors[0].msg):r.msg&&e(".error-msg-registry").text(r.msg)},error:function(){}}))})},submitBaseInfo:function(r){var t=this,o={identity:e("#idNo").val().trim(),mobile:e("#phoneNumber").val().trim(),msgAuthCode:e("#msgCode").val().trim(),name:e("#realName").val().trim()};e.ajax({url:t.config.baseInfoUrl,type:"POST",contentType:"application/json;charset=utf-8",data:JSON.stringify(o),success:function(e){r.call(t,e)},error:function(){}})},validatePwd:function(){var r=e("#pwd").val(),t=e("#pwd").val();return r&&t?r!=t?void e(".error-msg-registry").text(""):!0:void e(".error-msg-registry").text("")},countDown:function(r){var t=this,o=60,i=e("#"+r);i.addClass("disabled"),i.text("重新获取"+o+"s"),t.timer[r]=setInterval(function(){o--,i.text("重新获取"+o+"s"),0===o&&(clearInterval(t.timer[r]),i.removeClass("disabled"),i.text("获取验证码"))},1e3)},resetBtn:function(){this.timer.getCode&&clearInterval(this.timer.getCode),this.timer.registerGetCode&&clearInterval(this.timer.registerGetCode),e("#getCode").text("获取验证码").removeClass("disabled"),e("#registerGetCode").text("获取验证码").removeClass("disabled")},sendCode:function(r,t,o){var i=this,s={mobile:r,type:t};console.log(i.config.msgCodeUrl),e.ajax({url:i.config.msgCodeUrl,type:"POST",contentType:"application/json;charset=utf-8",data:JSON.stringify(s),success:function(e){o.call(i,e)},error:function(){}})},isValid:function(){var r=e("#sLoginMobile").val().trim(),t=e("#authCode").val().trim();return""==r?void e(".error-msg-code").text("请输入手机号！"):""==t?void e(".error-msg-code").text("请输入验证码！"):!0},formValid:function(){var r=e("#sLoginNo").val().trim(),t=e("#sPwd").val().trim();return""==r?void e(".error-msg").text("请输入登录账号！"):""==t?void e(".error-msg").text("请输入登录密码！"):!0},login:function(){var r=this,t=new JSEncrypt;t.setKey(o);var i={loginNo:e("#sLoginNo").val().trim(),password:t.encrypt(e("#sPwd").val().trim())};e.ajax({url:r.config.sLoginUrl,type:"POST",contentType:"application/json;charset=utf-8",data:JSON.stringify(i),success:function(r){return r.success?void window.location.reload():void e(".error-msg").text(r.msg)},error:function(){}}),console.log(i)},authLogin:function(){var r=this,t={mobile:e("#sLoginMobile").val().trim(),msgAuthCode:e("#authCode").val().trim()};e.ajax({url:r.config.codeLoginUrl,type:"POST",contentType:"application/json;charset=utf-8",data:JSON.stringify(t),success:function(t){return t.success?void(location.href=r.returnUrl&&""!=r.returnUrl?r.returnUrl:"/pc/follow.html"):void e(".error-msg-code").text(t.fieldErrors&&t.fieldErrors.length>0?t.fieldErrors[0].msg:t.msg)},error:function(){}})},refreshImg:function(){e("#imgAuth").attr("src",this.config.sGetImgUrl+"?v="+Math.random)}};i.init()})});