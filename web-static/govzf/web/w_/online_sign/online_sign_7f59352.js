define("web:widget/online_sign/online_sign.js",function(e){"use strict";e.async(["common:components/jquery/jquery.js","common:components/pcUI/dialog/dialog.js","common:components/pcUI/tips/tips.js"],function(e,n,o){var i=!1,t={flag:!1,config:{contractApplyUrl:"/web/contract/apply/"+aazPage.houseId,getMessCodeUrl:"/web/account/msgcode/6",checkMessCodeUrl:"/web/account/msgcode/",cardInfoZm:null,cardInfoFm:null},init:function(){e(".dialog-wrapper").dialog({customWraper:!0}),this.bindEvent(),this.initUpload()},bindEvent:function(){var n=this;e(".online-sign").on("click",function(){aazPage.isLogin&&""!=aazPage.isLogin?(e.ajax({url:window.configUrl.userInfo,type:"get",dataType:"json",success:function(n){n.success?n.data.identityCardFrontKey&&n.data.identityCardBackKey||e("#check_modal").dialog("instance").open():console.log(n.code)}}),n.getMessageCodeAjax(),e("#confirm-sign-form").dialog("instance").open()):e(".login-dialog-wrapper").dialog("instance").open()}),e(".confirm-sign-form-wrapper").on("click",".close-btn",function(){e("#confirm-sign-form").dialog("instance").close()}),e(".dialog-loading").on("click",".close-btn",function(){e(".dialog-loading").dialog("instance").close()}),e(".dialog-loading").on("click",".submit",function(){e(".dialog-loading").dialog("instance").close(),window.location.href="/pc/user/zuyue/list"}),e(".getMessageCode-btn").on("click",function(){e("#sign_error_msg").text(""),n.flag&&n.getMessageCodeAjax()}),e("#J_show_upload").click(function(){e("#J_upload_dailog").dialog("instance").open()}),e("#J_upload_dailog").on("click",".close-btn",function(){e("#J_upload_dailog").dialog("instance").close()}),e("#J_upload_dailog").on("click","#J_confirm_cardImg",function(){e("#J_upload_dailog").dialog("instance").close()}),e("#confirm-sign-info").on("submit",function(e){e.preventDefault(),n.checkMessageCodeAjax()})},isValid:function(){var n=e("#tenantAddress").val().trim(),o=e("#tenantPostCode").val().trim();return""===n?void e("#sign_error_msg").text("请输入详细地址"):""===o?void e("#sign_error_msg").text("请输入邮政编码"):/^\d{6}$/.test(o)?!0:void e("#sign_error_msg").text("邮政编码格式不正确")},initUpload:function(){var n=this;e("#J_uploadZm").click(function(){e("#J_fileInputZm").trigger("click")}),e("#J_uploadFm").click(function(){e("#J_fileInputFm").trigger("click")}),e("#J_zm_preview").on("click",".images-del",function(){e(this).parent().remove(),n.config.cardInfoZm=null}),e("#J_fm_preview").on("click",".images-del",function(){e(this).parent().remove(),n.config.cardInfoFm=null}),e("#J_fileInputZm").on("change",function(i){var t=new FormData,a=i.target.files||i.dataTransfer.files;for(var s in a)t.append("part"+s,a[s]);e.ajax({url:"http://"+uploadUrl+"/upload/house.html",type:"post",data:t,contentType:!1,processData:!1,cache:!1,success:function(i){if(i.code)return o.show(i.file),!1;for(var t in i){if(n.config.cardInfoFm&&n.config.cardInfoFm.imgKey&&n.config.cardInfoFm.imgKey==i[t].sKey)return void o.warn("请不要上传相同的图片！",3e3);var a={imgKey:i[t].sKey,imgExt:i[t].sExt};if(n.config.cardInfoZm=a,/^(png|jpe?g)$/.test(i[t].sExt)){var s="http://"+viewUrl+"/view/house/"+i[t].sKey+"/900x675."+i[t].sExt,c=e('<div class="image-item"><img src="'+s+'"><a class="images-del">x</a></div>');e("#J_zm_preview").append(c)}}}})}),e("#J_fileInputFm").on("change",function(i){var t=new FormData,a=i.target.files||i.dataTransfer.files;for(var s in a)t.append("part"+s,a[s]);e.ajax({url:"http://"+uploadUrl+"/upload/house.html",type:"post",data:t,contentType:!1,processData:!1,cache:!1,success:function(i){if(i.code)return o.show(i.file),!1;for(var t in i){if(n.config.cardInfoZm&&n.config.cardInfoZm.imgKey&&n.config.cardInfoZm.imgKey==i[t].sKey)return void o.warn("请不要上传相同的图片！",3e3);var a={imgKey:i[t].sKey,imgExt:i[t].sExt};if(n.config.cardInfoFm=a,/^(png|jpe?g)$/.test(i[t].sExt)){var s="http://"+viewUrl+"/view/house/"+i[t].sKey+"/900x675."+i[t].sExt,c=e('<div class="image-item"><img src="'+s+'"><a class="images-del">x</a></div>');e("#J_fm_preview").append(c)}}}})})},getMessageCodeAjax:function(){var n=this;e.ajax({url:n.config.getMessCodeUrl,type:"GET",success:function(i){return i.success?(n.flag=!1,void n.countDown()):(n.flag=!0,o.warn(i.msg),void e(".getMessageCode-btn").text("获取验证码"))},error:function(){}})},countDown:function(){var n=this,o=59,i=setInterval(function(){o>0?e(".getMessageCode-btn").text("重新获取"+o+"s"):(clearInterval(i),n.flag=!0,e(".getMessageCode-btn").text("获取验证码")),o--},1e3)},checkMessageCodeAjax:function(){var n=e("#messageCode").val().trim();if(""===n)return void e("#sign_error_msg").text("请输入手机验证码");var o=this;e.ajax({url:o.config.checkMessCodeUrl+n,type:"POST",success:function(n){if(n.success){if(i)return void e("#sign_error_msg").text("请不要重复提交");o.submitInfoAjax()}else e("#sign_error_msg").text(n.msg),e(".getMessageCode-btn").text("重新获取")},error:function(){e("#sign_error_msg").text("网络问题，请稍后重试")}})},submitInfoAjax:function(){var n=this,o=e("#tenantAddress").val().trim(),t=e("#tenantPostCode").val().trim();if(n.isValid()){i=!0;var a={tenantAddress:o,tenantPostCode:t,houseId:aazPage.houseId};e.ajax({url:n.config.contractApplyUrl,type:"POST",contentType:"application/json;charset=utf-8",data:JSON.stringify(a),success:function(n){return n.success?(1==n.data.type&&e(".dialog-content").html("签约申请已提交，请等待房东为您录入合同"),2==n.data.type&&e(".dialog-content").html("签约申请已提交，请等待房行为您录入合同"),3==n.data.type&&e(".dialog-content").html("签约申请已提交，请等待中介为您录入合同"),e("#confirm-sign-form").dialog("instance").close(),e(".dialog-loading").dialog("instance").open(),void 0):void e("#sign_error_msg").text(n.msg)},error:function(){i=!1}})}}};t.init()})});