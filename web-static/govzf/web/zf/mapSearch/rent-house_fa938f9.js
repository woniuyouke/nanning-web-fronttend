define("web:static/zf/mapSearch/rent-house.js",function(e){"use strict";e.async(["common:components/ui/zepto/zepto.js","common:components/ui/baiduMap/baiduMap.js","common:iscroll/iscroll.js","common:components/ui/loading/loading.js","common:components/ui/tips/tips.js","common:components/ui/getQueryString/getQueryString.js"],function(e,o,n,t,a,i){function l(o,n,t,a,i){e.ajax({url:o,type:n||"get",data:t,dataType:"json",beforeSend:function(){},success:function(e){u.hide(),0===e.code&&a&&a(e.data)},error:function(){u.hide(),i&&i()}})}function s(o){var n=!("show"!==o);g.isHouselistShow=n,n&&e("#houselist-wrap").scrollTop(0);var t=e("#houselist-wrap");t.css("display",n?"block":"none"),n||(e("#search_map").find(".label-selected").removeClass("label-selected"),e("#houselist_detail").html(""))}function c(e){var o=new BMap.NavigationControl({anchor:BMAP_ANCHOR_TOP_LEFT,type:BMAP_NAVIGATION_CONTROL_LARGE,enableGeolocation:!0});e.addControl(o);var n=new BMap.GeolocationControl;n.addEventListener("locationSuccess",function(e){var o="";o+=e.addressComponent.province,o+=e.addressComponent.city,o+=e.addressComponent.district,o+=e.addressComponent.street,o+=e.addressComponent.streetNumber,console.log("当前定位地址为："+o)}),n.addEventListener("locationError",function(e){alert(e.message)}),e.addControl(n)}function r(e,o){return e=(e+"").substr(0,8),o=(o+"").substr(0,8),e.split(".").join("_")+"_"+o.split(".").join("_")}var d={lng:i("lng"),lat:i("lat")},u=new t,m=~~e("#J_search_panel .selected").data("type"),p=[];window._cachePositionArr=p;var g={houseType:1,lastZoom:comConfig.initZoom,currentZoom:comConfig.plate_houseZoom,currentRegionId:"",clickedOverlayInfo:{},currentCenter:{},facetType:1,initPoint:{lng:114.0645445267,lat:22.5486544122},move_zoom_flag:!1,isLocateFirstData:!0,isRequestNewData:!0,isRaduisParamRequired:!0,handClickFlag:!1,isHouselistShow:!1};d.lng&&d.lat&&(console.log("...url params: ",d),comConfig.initZoom=comConfig.area_plateZoom,g.initPoint={lng:d.lng,lat:d.lat}),g.currentCenter=g.initPoint;var f={init:function(){e("#houselist-wrap-iconDown").tap(function(){s("hidden")}),e("#J_list_icon").tap(function(){var e=window.location.origin||"http://m.govzf.com";window.location=e+"pc/publicrental/list"}),e("#houselist_detail").css("margin-top",~~e(".labelinfo").height()||80)},baiduMap:function(){function o(o,c,r,d){d=d||1,o.clearOverlays(),o.removeEventListener("click"),p.length=0,s("hidden");var u=comConfig.mapSearchList;c=~~c;var m=c<comConfig.area_plateZoom?1:3,f=g.currentRegionId;3==m&&(f=g.clickedOverlayInfo.blockId);var v={cityId:comConfig.cityId,region:f,lng:r.lng,lat:r.lat,facetType:m,houseType:d};if(g.move_zoom_flag&&(v.region="",g.move_zoom_flag=!1),g.isRaduisParamRequired){var h=o.getBounds(),_=~~o.getDistance(h.getSouthWest(),h.getNorthEast())||9999;v.radius=_,g.isRaduisParamRequired=!1}if(_isMock){var h=o.getBounds(),w=h.getSouthWest(),C=h.getNorthEast();v=e.extend({},v,{mock_sw_lng:w.lng,mock_sw_lat:w.lat,mock_ne_lng:C.lng,mock_ne_lat:C.lat})}l(u,"get",v,function(e){var l=e.list&&e.list||[];if(!(l.length<1)){var s=l[0];if(g.isLocateFirstData&&(g.isRequestNewData=!1,o.panTo(new BMap.Point(s.lng,s.lat))),g.isLocateFirstData=!0,c<comConfig.area_plateZoom){var r=comConfig.plate_houseZoom;l.map(function(e){n(o,e,function(){a(e,r)})})}else l.map(c<comConfig.plate_houseZoom?function(e){t(o,e,1,function(){i(e)})}:c<comConfig.house_houseZoom?function(e){t(o,e,1,function(){i(e)})}:function(e){t(o,e,2,function(){i(e)})})}})}function n(e,o,n){var t=d(o);if(t){var a={position:new BMap.Point(o.lng,o.lat),offset:new BMap.Size(-40,-40)},i='<div class="map-label map-label-region"><div class="overlay-title">'+(o.name||"XX区")+'</div><div class="total">'+(o.count||0)+"</div></div>",l=new BMap.Label(i,a);n&&l.addEventListener("click",n),e.addOverlay(l)}}function t(e,o,n,t){var a=d(o);if(a){var i={position:new BMap.Point(o.lng,o.lat),offset:new BMap.Size(-40,-40)},l=(2===~~g.houseType?(o.count||0)+"套":o.sPrice||"0元/㎡/月",""),s=r(o.lat,o.lng),c='<div id="map_label_'+s+'" class="map-label map-label-house box-down"><span class="overlay-title">'+(o.name||"XX公寓")+l+"</span></div>",u=new BMap.Label(c,i);t&&u.addEventListener("click",t),e.addOverlay(u)}}function a(e,o){g.currentRegionId=e.id,g.clickedOverlayInfo=e,g.handClickFlag=!0,g.currentCenter={lng:e.lng,lat:e.lat},u.centerAndZoom(new BMap.Point(e.lng,e.lat),o)}function i(e){e=e||{},window.location=e.linkUrl}function d(){return!0}var u=new BMap.Map("search_map");window.map=u;var f=new BMap.Point(g.initPoint.lng,g.initPoint.lat),v=comConfig.plate_houseZoom;u.centerAndZoom(f,v),u.enableScrollWheelZoom(),u.disableDoubleClickZoom(),u.addEventListener("tilesloaded",function(){g.lastZoom=g.currentZoom;var e=u.getZoom(),n=g.currentCenter;console.log(">>>map loaded. currentZoom is %s, currentCenter is: lng-%s, lat-%s",e,n.lng,n.lat),g.isRequestNewData&&o(u,e,n,g.houseType),g.isRequestNewData=!0,g.currentZoom=e}),u.addEventListener("dragend",function(){var e=u.getCenter();g.isRaduisParamRequired=!0,g.move_zoom_flag=!0,g.isLocateFirstData=!1,g.currentCenter={lng:e.lng,lat:e.lat}}),u.addEventListener("zoomend",function(){g.handClickFlag||(g.isRaduisParamRequired=!0,g.move_zoom_flag=!0),g.isLocateFirstData=!!g.handClickFlag,g.handClickFlag=!1}),u.addEventListener("click",function(e){var o=e&&e.ab&&e.ab.V&&e.ab.V.className&&e.ab.V.className.indexOf("BMapLabel")>-1;o||g.isHouselistShow&&s("hidden")}),e("#J_search_panel").on("click",".type",function(){var o=e(this);o.parent().find(".type").removeClass("selected"),o.addClass("selected");var n=~~o.attr("data-type");console.log("current selected: "+n),n!==m&&(window.location=1===~~n?"/map/public":"/map/rent")}),c(u)}};f.init(),f.baiduMap()})});