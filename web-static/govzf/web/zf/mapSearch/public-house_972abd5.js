define("web:static/zf/mapSearch/public-house.js",function(e){"use strict";e.async(["common:components/ui/zepto/zepto.js","common:components/ui/baiduMap/baiduMap.js","common:iscroll/iscroll.js","common:components/ui/loading/loading.js","common:components/ui/tips/tips.js","common:components/ui/getQueryString/getQueryString.js"],function(e,a,o,n,t,i){function l(a,o,n,t,i){e.ajax({url:a,type:o||"get",data:n,dataType:"json",beforeSend:function(){},success:function(e){p.hide(),0===e.code&&t&&t(e.data)},error:function(){p.hide(),i&&i()}})}function s(a){var o=!("show"!==a);v.isHouselistShow=o,o&&e("#houselist-wrap").scrollTop(0);var n=e("#houselist-wrap");n.css("display",o?"block":"none"),o||(e("#search_map").find(".label-selected").removeClass("label-selected"),e("#houselist_detail").html(""))}function c(a){if(0===a.length)return void e("#houselist_detail").html('<div class="no-houselist">暂无房源信息</div>');var o=a.length&&a.map(function(e){var a=e.tags||[],o=a.slice(0,3).map(function(e){return'<span class="tagItem">'+e+"</span>"}),n="/static/zf/common/default/loading/img_loading_256_192.png",t=e.picUrls&&e.picUrls[0]||n,i="";e.logoUrl?i='<img class="brand-img" src='+e.logoUrl+' alt="">':e.brandName&&(i=e.brandName);var l=1===~~e.isGuaranty?'<span class="guaranty">信用免押</span>':"";return"<a href="+e.url+' class="listItem" style="display: block"><div class="left"><img class="lazy" src='+t+'></div><div class="right"><div class="title">'+(e.layout||"0室0厅")+" · "+(e.area||"0㎡")+" · "+r(e.rentType)+'</div><p class="tag-wrap">'+o.join("")+'</p><p class="month-price">'+(e.price||"0")+"元/月"+l+'</p><p class="house-logo">'+i+"</p></div></a>"});e("#houselist_detail").html("").append(o.join(""))}function r(e){return 2===~~e?"合租":"整租"}function d(e){var a=new BMap.NavigationControl({anchor:BMAP_ANCHOR_TOP_LEFT,type:BMAP_NAVIGATION_CONTROL_LARGE,enableGeolocation:!0});e.addControl(a);var o=new BMap.GeolocationControl;o.addEventListener("locationSuccess",function(e){var a="";a+=e.addressComponent.province,a+=e.addressComponent.city,a+=e.addressComponent.district,a+=e.addressComponent.street,a+=e.addressComponent.streetNumber,console.log("当前定位地址为："+a)}),o.addEventListener("locationError",function(e){alert(e.message)}),e.addControl(o)}function m(e,a){return e=(e+"").substr(0,8),a=(a+"").substr(0,8),e.split(".").join("_")+"_"+a.split(".").join("_")}var u={lng:i("lng"),lat:i("lat")},p=new n,g=~~e("#J_search_panel .selected").data("type"),f=[];window._cachePositionArr=f;var v={houseType:g,lastZoom:comConfig.initZoom,currentZoom:1==g?comConfig.plate_houseZoom:comConfig.initZoom,currentRegionId:"",clickedOverlayInfo:{},currentCenter:{},facetType:1,initPoint:{lng:114.0645445267,lat:22.5486544122},move_zoom_flag:!1,isLocateFirstData:1==g?!0:!1,isRequestNewData:!0,isRaduisParamRequired:!0,handClickFlag:!1,isHouselistShow:!1};u.lng&&u.lat&&(console.log("...url params: ",u),comConfig.initZoom=comConfig.area_plateZoom,v.initPoint={lng:u.lng,lat:u.lat}),v.currentCenter=v.initPoint;var h={init:function(){e("#houselist-wrap-iconDown").tap(function(){s("hidden")}),e("#J_list_icon").tap(function(){var e=window.location.origin||"http://m.govzf.com";window.location=e+(1===g?"pc/publicrental/list":"pc/list")}),e("#houselist_detail").css("margin-top",~~e(".labelinfo").height()||80)},baiduMap:function(){function a(a,c,d,m){m=m||1,a.clearOverlays(),a.removeEventListener("click"),f.length=0,s("hidden");var u=comConfig.mapSearchList;c=~~c;var p;p=1===g?c<comConfig.area_plateZoom?1:3:c<comConfig.area_plateZoom?1:c<comConfig.plate_houseZoom?2:3;var h=v.currentRegionId;1==g&&3==p&&(h=v.clickedOverlayInfo.blockId);var _={cityId:comConfig.cityId,region:h,lng:d.lng,lat:d.lat,facetType:p,houseType:m};if(v.move_zoom_flag&&(_.region="",v.move_zoom_flag=!1),v.isRaduisParamRequired){var b=a.getBounds(),w=~~a.getDistance(b.getSouthWest(),b.getNorthEast())||9999;_.radius=w,v.isRaduisParamRequired=!1}if(_isMock){var b=a.getBounds(),C=b.getSouthWest(),y=b.getNorthEast();_=e.extend({},_,{mock_sw_lng:C.lng,mock_sw_lat:C.lat,mock_ne_lng:y.lng,mock_ne_lat:y.lat})}l(u,"get",_,function(e){var l=e.list&&e.list||[];if(!(l.length<1)){var s=l[0];if(v.isLocateFirstData&&(v.isRequestNewData=!1,a.panTo(new BMap.Point(s.lng,s.lat))),v.isLocateFirstData=!0,c<comConfig.area_plateZoom){var d=1===g?comConfig.plate_houseZoom:comConfig.area_plateZoom;l.map(function(e){o(a,e,function(){i(e,d)})})}else l.map(c<comConfig.plate_houseZoom?function(e){1===g?t(a,e,1,function(){r(e)}):n(a,e,function(){i(e,comConfig.house_houseZoom)})}:c<comConfig.house_houseZoom?function(e){1===g?t(a,e,1,function(){r(e)}):t(a,e,1)}:function(e){t(a,e,2,function(){r(e)})})}})}function o(e,a,o){var n=u(a);if(n){var t={position:new BMap.Point(a.lng,a.lat),offset:new BMap.Size(-40,-40)},i='<div class="map-label map-label-region"><div class="overlay-title">'+(a.name||"XX区")+'</div><div class="total">'+(a.count||0)+"</div></div>",l=new BMap.Label(i,t);o&&l.addEventListener("click",o),e.addOverlay(l)}}function n(e,a,o){var n=u(a);if(n){var t={position:new BMap.Point(a.lng,a.lat),offset:new BMap.Size(-40,-40)},i='<div class="map-label map-label-region"><div class="overlay-title">'+(a.name||"XX板块")+'</div><div class="total">'+(a.count||0)+"</div></div>",l=new BMap.Label(i,t);o&&l.addEventListener("click",o),e.addOverlay(l)}}function t(e,a,o,n){var t=u(a);if(t){var i={position:new BMap.Point(a.lng,a.lat),offset:new BMap.Size(-40,-40)},l=(2===~~v.houseType?(a.count||0)+"套":a.sPrice||"0元/㎡/月",""),s=m(a.lat,a.lng),c='<div id="map_label_'+s+'" class="map-label map-label-house box-down"><span class="overlay-title">'+(a.name||"XX公寓")+l+"</span></div>";2===g&&1===o&&(c='<div id="map_label_'+s+'" class="map-label map-label-house box-down"><span>'+(a.count||0)+"套</span></div>");var r=new BMap.Label(c,i);n&&r.addEventListener("click",n),e.addOverlay(r)}}function i(e,a){v.currentRegionId=e.id,v.clickedOverlayInfo=e,v.handClickFlag=!0,v.currentCenter={lng:e.lng,lat:e.lat},p.centerAndZoom(new BMap.Point(e.lng,e.lat),a)}function r(a){if(a=a||{},1===g)return void(window.location=a.linkUrl);s("show"),e("#search_map").find(".label-selected").removeClass("label-selected");var o="map_label_"+m(a.lat,a.lng);e("#"+o).addClass("label-selected");var n=comConfig.suggestHouseListUrl;l(n,"get",{xqId:a.id},function(a){var o=a||{},n=e("#regioninfo-wrap");n.find(".title").html(o.name||"小区"),n.find(".count span").html(o.total||0),n.find(".location").html(o.location+" "+o.address||"罗湖-东门 中山东街888号"),c(o.list||[])})}function u(){return!0}var p=new BMap.Map("search_map");window.map=p;var h=new BMap.Point(v.initPoint.lng,v.initPoint.lat),_=1==g?comConfig.plate_houseZoom:comConfig.initZoom;p.centerAndZoom(h,_),p.enableScrollWheelZoom(),p.disableDoubleClickZoom(),p.addEventListener("tilesloaded",function(){v.lastZoom=v.currentZoom;var e=p.getZoom(),o=v.currentCenter;console.log(">>>map loaded. currentZoom is %s, currentCenter is: lng-%s, lat-%s",e,o.lng,o.lat),v.isRequestNewData&&a(p,e,o,v.houseType),v.isRequestNewData=!0,v.currentZoom=e}),p.addEventListener("dragend",function(){var e=p.getCenter();v.isRaduisParamRequired=!0,v.move_zoom_flag=!0,v.isLocateFirstData=!1,v.currentCenter={lng:e.lng,lat:e.lat}}),p.addEventListener("zoomend",function(){v.handClickFlag||(v.isRaduisParamRequired=!0,v.move_zoom_flag=!0),v.isLocateFirstData=!!v.handClickFlag,v.handClickFlag=!1}),p.addEventListener("click",function(e){var a=e&&e.ab&&e.ab.V&&e.ab.V.className&&e.ab.V.className.indexOf("BMapLabel")>-1;a||v.isHouselistShow&&s("hidden")}),e("#J_search_panel").on("click",".type",function(){var a=e(this);a.parent().find(".type").removeClass("selected"),a.addClass("selected");var o=~~a.attr("data-type");console.log("current selected: "+o),o!==g&&(window.location=1===~~o?"/map/public":"/map/rent")}),d(p)}};h.init(),h.baiduMap()})});