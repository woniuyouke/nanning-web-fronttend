define("web:static/zf/mapSearch/index.js",function(e){"use strict";e.async(["common:components/jquery/jquery.js","common:components/ui/baiduMap/baiduMap.js","common:components/ui/tips/tips.js","common:components/ui/getQueryString/getQueryString.js","common:components/pcUI/tips/tips.js","web:static/zf/mapSearch/base.js","web:components/dropSelect/dropSelect.js"],function(e,a,t,n,o,i){function l(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],a=e.needRadiusParam,t=window._bdMmap,n=P.currentZoom,o=t.getCenter(),l=b.houseType;(f&&P.lastZoom!==n||!f)&&(t.clearOverlays(),t.removeEventListener("click"),v.length=0);var u=b.mapSearchList+i.jointSearchParamStr(P.searchParams);n=~~n;var p;p=1===l?n<w.plate_houseZoom?1:3:n<w.plate_houseZoom?1:3,p=2===l?n<w.plate_houseZoom?1:3:n<w.plate_houseZoom?1:3;var g=P.currentRegionId;1==l&&3==p&&(g=P.clickedOverlayInfo.blockId),1==p&&(g="");var h={cityId:b.cityId,regionId:g,lng:o.lng,lat:o.lat,facetType:p,houseType:l};if(P.move_zoom_flag&&(h.region="",P.move_zoom_flag=!1),P.isRaduisParamRequired){var _=t.getBounds(),y=10*~~t.getDistance(_.getSouthWest(),_.getNorthEast())||9999;h.radius=y,a||(P.isRaduisParamRequired=!1)}m(u,"get",h,function(e){P.needJointRegionlistInfo&&(i.jointRegionlistInfo(e),P.needJointRegionlistInfo=!1);var a=e.list&&e.list||[];if(!(a.length<1)){var o=a[0];if(P.isLocateFirstData&&(P.isRequestNewData=!1,t.panTo(new BMap.Point(o.lng,o.lat))),P.isLocateFirstData=!1,n<w.plate_houseZoom){var l=1===b.houseType?w.plate_houseZoom:w.house_houseZoom;a.map(function(e){r(t,e,function(){c(e,l)})})}else a.map(n<w.house_houseZoom?function(e){1===b.houseType?s(t,e,1,function(){d(e)}):s(t,e,1,function(){d(e)})}:function(e){s(t,e,2,function(){d(e)})})}})}function r(e,a,t){var n=u(a);if(n){var o={position:new BMap.Point(a.lng,a.lat),offset:new BMap.Size(-40,-40)},i='<div class="map-label map-label-region"><div class="overlay-title">'+(a.name||"XX区")+'</div><div class="total">'+(a.count||0)+"</div></div>",l=new BMap.Label(i,o);t&&l.addEventListener("click",t),e.addOverlay(l)}}function s(e,a,t,n){var o=u(a);if(o){var l={position:new BMap.Point(a.lng,a.lat),offset:new BMap.Size(-40,-40)},r=(2===~~b.houseType?(a.count||0)+"套":a.sPrice||"0元/㎡/月",""),s=i.computeLabelId(a.lat,a.lng),c='<div id="map_label_'+s+'" class="map-label map-label-house box-down"><span class="overlay-title">'+(a.name||"XX公寓")+r+"</span></div>";2===b.houseType&&1===t&&(c='<div id="map_label_'+s+'" class="map-label map-label-house box-down"><span>'+(a.count||0)+"套</span></div>");var d=new BMap.Label(c,l);n&&d.addEventListener("click",n),e.addOverlay(d)}}function c(e,a){P.currentRegionId=e.id,P.clickedOverlayInfo=e,P.handClickFlag=!0,P.needJointRegionlistInfo=!0,map.centerAndZoom(new BMap.Point(e.lng,e.lat),a)}function d(a){if(a=a||{},1===b.houseType)return void window.open(a.linkUrl);e("#search_map").find(".label-selected").removeClass("label-selected");var n="map_label_"+i.computeLabelId(a.lat,a.lng);e("#"+n).addClass("label-selected");var o=b.suggestHouseListUrl+i.jointSearchParamStr(P.searchParams);m(o,"get",{xqId:a.id},function(a){a=a||{};var n=a.breadCrumb||{},o=n.city,l=void 0===o?{}:o,r=n.district,s=void 0===r?{}:r,c=n.block,d=void 0===c?{}:c,u=[l,s,d].filter(function(e){return e.id&&e.name});u.length&&u.push({name:a.name}),i.renderSuggestHouseList(e.extend({},a,{crumbList:u,Tips:t}))})}function u(e){if(f)return!0;var a=P.currentZoom+"-"+e.lng+"-"+e.lat,t=v.indexOf(a)>-1;return t||v.push(a),!t}function m(a,t,n,o,i){e.ajax({url:a,type:t||"get",data:n,dataType:"json",beforeSend:function(){e(".loading-tips").show()},success:function(e){0===e.code&&o&&o(e.data)},error:function(){i&&i()},complete:function(){e(".loading-tips").hide()}})}function p(){var a={defaultValue:[],mainWidth:120,rangeFlag:!1,type:"single",showSelectedVal:!0},t=e.extend({},a,{title:"租金",data:_pageDefaultData.rentSelectData,rangeFlag:!0,rangeConfig:{unit:"元",fromPlaceholder:"最低租金",toPlaceholder:"最高租金"},selectHandler:function(e){var a=e[0]||"",t=e.length?"pe"+a:"";g({rent:t})},confirmHandler:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],a=e.from,t=void 0===a?"":a,n=e.to,o=void 0===n?"":n,i=t||o?"pe"+t+"_"+o:"";g({rent:i})}}),n=e("#ds_rentprice").dropSelect(t),o=e.extend({},a,{title:"户型",data:_pageDefaultData.layoutSelectData,type:"multiple",selectHandler:function(e){var a=e.length?"rm"+e.join("_"):"";g({layout:a})}}),i=e("#ds_layout").dropSelect(o),l=e.extend({},a,{title:"面积",data:_pageDefaultData.areaSelectData,rangeFlag:!0,rangeConfig:{unit:"m²",fromPlaceholder:"最小面积",toPlaceholder:"最大面积"},selectHandler:function(e){var a=e[0]||"",t=a?"sp"+a:"";g({area:t})},confirmHandler:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],a=e.from,t=void 0===a?"":a,n=e.to,o=void 0===n?"":n,i=t||o?"sp"+t+"_"+o:"";g({area:i})}}),r=e("#ds_area").dropSelect(l),s=e.extend({},a,{title:"出租方式",data:_pageDefaultData.rentStyleSelectData,selectHandler:function(e){var a=e.length?"re"+e.join("_"):"";g({rentType:a})}}),c=e("#ds_rentstyle").dropSelect(s),d=(localStorage.getItem("isMarket"),e.extend({},a,{title:"类型",data:[{key:1,value:"公租房"},{key:2,value:"人才房"},{key:3,value:"廉租房"}],selectHandler:function(e){var a=e.length?"ht"+e.join("_"):"";g({gzfType:a})}})),u=e("#ds_houseType").dropSelect(d),m=e.extend({},a,{title:"项目状态",data:[{key:1,value:"开放申请"},{key:2,value:"即将申请"},{key:3,value:"结束申请"}],selectHandler:function(e){var a=e.length?"hs"+e.join("_"):"";g({gzfState:a})}}),m=e("#ds_projState").dropSelect(m);e("#ds_clear").on("click",function(){n.clear(),i.clear(),r.clear(),c.clear(),u.clear(),m.clear(),g(Z)})}function g(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];P.needJointRegionlistInfo=!0,Object.assign(P.searchParams,e),l({needRadiusParam:!0})}var h={lng:n("lng"),lat:n("lat")},f=!1,v=[];window._cachePositionArr=v;var _=!1,y=_?"http://www.gov1.anhouse.com.cn/":"",b={cityId:5029,suggestHouseListUrl:y+"/pc/api/maplist",mapSearchList:y+"/pc/api/map/list",houseType:~~e("#J_search_panel .selected").data("type")},w={initZoom:10,initPoint:{lng:_config.lanlnt.split(",")[0],lat:_config.lanlnt.split(",")[1]},plate_houseZoom:13,house_houseZoom:15},Z={rent:"",layout:"",area:"",rentType:"",source:"",gzfType:"",gzfState:""},P={lastZoom:w.initZoom,currentZoom:1==b.houseType?w.plate_houseZoom:w.initZoom,currentRegionId:"",clickedOverlayInfo:{},move_zoom_flag:!1,isLocateFirstData:1==b.houseType?!0:!1,isRequestNewData:!0,isRaduisParamRequired:!0,handClickFlag:!1,needJointRegionlistInfo:!0,searchParams:e.extend({},Z)};h.lng&&h.lat&&(w.initZoom=w.plate_houseZoom,w.initPoint={lng:h.lng,lat:h.lat});var S={init:function(){e("#J_list_icon").click(function(){window.location=(1===b.houseType?myHeader.config.publicrentalListUrl:myHeader.config.commonListUrl)+i.jointSearchParamStr(P.searchParams)}),e("#houselist_detail").css("margin-top",~~e(".labelinfo").height()||80),e(".maplists-wrap").css("height",e(window).height()-e(".header-wrap").height()),e("#J_search_panel").on("click",".type",function(){var a=e(this),t=~~a.attr("data-type");-1!==t&&(a.parent().find(".type").removeClass("selected"),a.addClass("selected"),t!==b.houseType&&(window.location=1===~~t?"/pc/map/public":"/pc/map/rent"))}),e("#J_toggle_icon").click(function(){var a=e(this),t=~~a.attr("data-type"),n=0===t?0:400;e(".maplists-wrap").css("width",n),a.css("left",n);var o=0===t?-90:90;a.find(".iconfont").css("transform","rotate("+o+"deg)"),a.attr("data-type",[1,0][t]),e("#J_search_panel").css("left",0===t?16:416)}),e(".maplists-wrap .area-list").on("click",".list-item",function(){var a=e(this),t=a.attr("data-id"),n=~~a.attr("data-type"),o={id:t,lng:a.attr("data-lng")||w.initPoint.lng,lat:a.attr("data-lat")||w.initPoint.lat};if(2>n){var i=[w.house_houseZoom,w.house_houseZoom];c(o,i[n])}else 2===n?d(o):console.error('Ohopss, param "type" is out of Service!!')}),e("#J_maplist_header").on("click",".crumb-item",function(){var a=e(this),t=a.attr("data-id"),n=a.attr("data-lng")||w.initPoint.lng,o=a.attr("data-lat")||w.initPoint.lat,i=~~a.attr("data-type"),l=a.attr("data-tail");if("true"!==l){e(".position").html("");var r={id:t,lng:n,lat:o},s=0===i?w.initZoom:1===i?w.plate_houseZoom:w.plate_houseZoom;c(r,s)}}),p()},initBaiduMap:function(){var e=new BMap.Map("search_map",{minZoom:9,maxZoom:18});window.map=e;var a=new BMap.Point(w.initPoint.lng,w.initPoint.lat),t=w.initZoom;e.centerAndZoom(a,t),e.enableScrollWheelZoom(),e.disableDoubleClickZoom();var n=new BMap.ScaleControl({anchor:BMAP_ANCHOR_BOTTOM_RIGHT});e.addControl(n);var o=new BMap.NavigationControl({anchor:BMAP_ANCHOR_BOTTOM_RIGHT,type:BMAP_NAVIGATION_CONTROL_ZOOM});return e.addControl(o),e},baiduMap:function(){var a=S.initBaiduMap();window._bdMmap=a,e("body").on("mouseenter",".BMapLabel",function(){e(this).addClass("BMapLabel-hovered")}).on("mouseleave",".BMapLabel",function(){e(this).removeClass("BMapLabel-hovered")}),a.addEventListener("dragend",function(){var e=a.getCenter();console.log("+++map dragend.. lng: "+e.lng+", lat: "+e.lat),P.isRaduisParamRequired=!0,P.move_zoom_flag=!0,P.isLocateFirstData=!1}),a.addEventListener("zoomend",function(){console.log("map zoomed："+this.getZoom()+"级"),P.handClickFlag||(P.isRaduisParamRequired=!0,P.move_zoom_flag=!0),P.isLocateFirstData=!!P.handClickFlag,P.handClickFlag=!1}),a.addEventListener("tilesloaded",function(){P.lastZoom=P.currentZoom;{var e=a.getZoom();a.getCenter()}P.currentZoom=e,P.isRequestNewData&&l({needRadiusParam:!0}),P.isRequestNewData=!0})}};S.init(),S.baiduMap()})});