define("common:widget/h5/nps/nps.js",function(e){e.async(["common:components/ui/zepto/zepto.js","common:components/ui/dialog/dialog.js","common:components/ui/template/template.js"],function(e,t,n){var o={conf:{},domain:e("#J_basedomain").val(),init:function(){this.getData(),this.addEvent()},getData:function(){console.log(e("#J_npsUrl").val());var t=this;e.ajax({url:e("#J_npsUrl").val(),type:"GET",dataType:"jsonp",success:function(n){if(0===n.code){if(!n.data.ok)return!1;t.conf=e.extend(t.conf,n.data.search),t.showDialog()}}})},showDialog:function(){var e=this;!e.isEvent()&&e.isSearch()&&!e.isHide()&&e.isShow()&&setTimeout(function(){e.createDialog()},1e3*e.conf.showing_delay)},createDialog:function(){{var t=this,o=t.conf;n.fetch("J_npsTpl",{data:o})}e("#J_npsDialog").dialog({autoOpen:!0,className:"nps-dialog-wraper"}),e(".nps-dialog-wraper .ui2-dialog-close").unbind("tap"),e(".nps-dialog-wraper .ui2-dialog-close").on("touchend",function(){e(".nps-dialog-wraper").hide(),e(".nps-dialog-wraper").prev(".ui2-mask").hide();var n=t.getCookie("npsRefuseM",0);return t.setCookie("npsRefuseM",parseInt(n)+1,o.max_rejecting_days),globalLog.setArgusObj({self_event_type:"NPS_CLICK_GB"}),globalLog.send(),!1})},addEvent:function(){var t=this;e("body").delegate("#J_npsBtn","click",function(){var e=new Date,n=t.getTimeStr(e.getFullYear()),o=t.getTimeStr(e.getMonth()+1),i=t.getTimeStr(e.getDate()),a=t.getTimeStr(e.getHours()),s=t.getTimeStr(e.getMinutes()),r=t.getTimeStr(e.getSeconds()),c=n+o+i+a+s+r,l=t.conf;window.location.href=l.url+"&ModelNo=PAHF_N0000000007&TxnTime="+c+"&CallBackUrl="+encodeURI(window.location.href),t.setCookie("npsAgreeM",1,l.max_rejecting_days),globalLog.setArgusObj({self_event_type:"NPS_CLICK_LJCY"}),globalLog.send()})},getTimeStr:function(e){var t=String(e);return t.length<=1&&(t="0"+t),t},isSearch:function(){var e=0,t=document.referrer,n=(window.location.href,t.split("?")[1]?t.split("?")[1]:""),o=window.location.search;o.indexOf("?")>-1&&(o=o.substr(1));var i=/\/search/;(this.isKw(n)||this.isKw(o)||t.match(i))&&(e=1);var a=/(list)\/[a-z]{2}[\d_a-z]+(-[a-z]{2}[\d_a-z]+)*/;if(t.match(a)){{t.split("/list/")}if(param){param.split("-")}e=1}return e},isKw:function(e){for(var t=0,n=[],o=e.split("&"),i=0;i<o.length;i++)n.push(o[i].split("=")[0]);return n.indexOf("kw")>-1&&(t=1),t},isEvent:function(){var e=0,t=/event/;return document.referrer.match(t)&&(e=1),e},isShow:function(){var e=0,t=this.conf.showing_possibility,n=Math.ceil(100*Math.random());return t>0&&n>=1&&t>=n&&(e=1),e},isHide:function(){var e=this,t=0,n=e.getCookie("npsAgreeM",0),o=e.getCookie("npsRefuseM",0);return(n>0||o>=e.conf.max_rejecting_count)&&(t=1),t},setCookie:function(e,t,n){var o=this,i=new Date;i.setDate(i.getDate()+n),document.cookie=e+"="+escape(t)+(null==n?"":";expires="+i.toGMTString())+";domain="+o.domain+";path=/"},getCookie:function(e,t){if(document.cookie.length>0){var n=document.cookie.indexOf(e+"=");if(n>-1){n+=e.length+1;var o=document.cookie.indexOf(";",n);return-1==o&&(o=document.cookie.length),unescape(document.cookie.substring(n,o))}return t}}};o.init()})});