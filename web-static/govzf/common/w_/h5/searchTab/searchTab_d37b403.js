define("common:widget/h5/searchTab/searchTab.js",function(e){e.async(["common:components/ui/zepto/zepto.js","common:components/ui/nstSlider/nouislider.js"],function(e,a){function t(e){return e?M[e]:""}function n(e,a){var t=a?"":H[e](a);return t===!1?!1:void(searchTabConfig.selected[M[e]]=t)}function s(e,a,t){var s=n(e,a);s===!1||t||i(e,a)}function r(){e(".search-tab-wrapper").hide(),e(".search-tab-item").removeClass("spread"),e(".search-tab-toggle-mask").addClass("uns"),x(),L=!1}function i(a,t){if(t)return U[a](),void b();if(searchTabConfig.callback)return r(),searchTabConfig.callback(g(searchTabConfig.selected)),e(".search-tab-item").removeClass("active"),void b();var n=window.location.pathname;"/"==n.substring(n.length,n.length-1)&&(n=n.substring(0,n.length-1)),searchTabConfig.hasMetro&&!searchTabConfig.selected.ln&&(n=n.replace("/metro","/list"));var s=n.split("/")||[];s.indexOf("list")<0&&s.indexOf("metro")<0&&!searchTabConfig.mapList?(s.push("list"),s.push("")):s.indexOf("list")==s.length-1&&s.push(""),searchTabConfig.mapList&&(s.indexOf("public")==s.length-1||s.indexOf("rent")==s.length-1)?s[s.length]=g(searchTabConfig.selected):s[s.length-1]=g(searchTabConfig.selected);var i=window.location.origin+s.join("/").replace("//","/");location.replace((i+location.search).replace("/?","?").replace(/\/$/,""))}function c(a){A[a]&&e.each(A[a],function(e,a){n(a,!0)}),s(a,!0)}function o(e){n(e+"Second",!0),s(e,!0,!0)}function l(a){var t=e("#filter-"+a)[0].noUiSlider.get();t=e.map(t,function(e){return parseInt(e,10)}),t[0]<searchTabConfig[a+"Config"].range.min&&(t[0]=""),t[1]>searchTabConfig[a+"Config"].range.max&&(t[1]="");var n=t.join("_");return"_"==n?"":n}function u(a){var t=[];return e("."+a+"-item.active").each(function(a,n){t.push(e(n).data("value"))}),t.join("_")}function h(e){var a=document.getElementById("filter-"+e),t=searchTabConfig[e+"Config"].range,n=Math.abs(parseInt(t.min,10)-parseInt(t.step,10)),s=parseInt(t.max,10)+parseInt(t.step,10);a.noUiSlider.set([n,s])}function d(t,n){if(searchTabConfig[t+"Config"]){var s=searchTabConfig[t+"Config"].range,r=document.getElementById("filter-"+t),i=Math.abs(parseInt(s.min,10)-parseInt(s.step,10)),c=parseInt(s.max,10)+parseInt(s.step,10),o=searchTabConfig.selected[M[t]];if(o){var l=o.split("_");i=parseInt(l[0]?l[0]:i,10),c=parseInt(l[1]?l[1]:c,10)}a.create(r,{start:[i,c],connect:!0,margin:parseInt(s.step,10),step:parseInt(s.step,10),range:{min:parseInt(s.min,10)-parseInt(s.step,10),max:parseInt(s.max,10)+parseInt(s.step,10)}}),r.noUiSlider.on("update",function(a){var r=parseInt(a[0],10),i=parseInt(a[1],10),c="";r<s.min&&i>s.max?c="不限":r>=s.min&&i>s.max?c=r+(s.unit||n.unit)+"以上":r>=s.min&&i<=s.max?c=r+"-"+i+(s.unit||n.unit):r<s.min&&i<=s.max&&(c=i+(s.unit||n.unit)+"以下"),e("#search-tab-"+t+" .title-right").html(c)})}}function b(){var a=searchTabConfig.selected;e.each(a,function(a,t){"subway"==P[a]||"nb"==P[a]||P[a]&&P[a].indexOf("Second")>0||"pg"==a||(t?0==e("#search-tab-ul .search-tab-"+P[a]).length?e("#search-tab-ul .search-tab-more").addClass("active"):(e("#search-tab-ul .search-tab-"+P[a]).addClass("active"),f(e("#search-tab-ul .search-tab-"+P[a]),P[a])):(e("#search-tab-ul .search-tab-"+P[a]).removeClass("active").find(".search-value").html(e("#search-tab-ul .search-tab-"+P[a]).data("text")),k()))}),a[M.subway]?(e("#search-tab-ul .search-tab-region").addClass("active"),f(e("#search-tab-ul .search-tab-region"),"subway")):a[M.nb]&&(e("#search-tab-ul .search-tab-region").addClass("active"),e("#region-first-level .search-tab-list-item").removeClass("active"),e('#region-first-level [data-value="-100"]').addClass("active"),f(e("#search-tab-ul .search-tab-region"),"nb"))}function f(a,t){var n="";if("subway"==t||"region"==t)n=e("#"+t+"-list .search-tab-show-text.active").text();else if("nb"==t)n="附近";else{if("more"==t||"sort"==t)return;n="applicationStatus"==t||"publicType"==t?e("#search-tab-"+t+" .search-tab-list-item.active").text():"filter"==e("#search-tab-"+t).data("mode")?e("#search-tab-"+t+" .search-tab-show-text").text():e("#search-tab-"+t+" .search-tab-show-text.active").length>1?"多选":e("#search-tab-"+t+" .search-tab-show-text.active").text()}e(a).find(".search-value").html(n)}function v(){e(".search-tab-content-tab").click(function(a){return e(a.target).hasClass("content-item")&&!e(a.target).hasClass("jump-out")?(e(a.target).toggleClass("active"),k(),!1):void 0})}function g(a){var t=[];return e.each(a,function(e,a){a&&t.push(e+a)}),t.join("-")}function p(a,t){e("#"+a+"-first-level .search-tab-list-item").each(function(a,n){var s=e(n).data("value");s==t||!t&&!s?e(n).addClass("active"):e(n).removeClass("active")})}function m(){e(".search-tab-single-list").each(function(a,t){C(e(t).attr("id").replace("-first-level",""))})}function C(e){y(e,!0)}function y(a,n){if(searchTabConfig.data[a]&&void 0!==searchTabConfig.selected[t(a)]){var s=searchTabConfig.selected[t(a)];if(p(a,s),n)return;e("#"+a+"-second-level").html("").addClass("uns"),e.each(searchTabConfig.data[a],function(t,n){s&&n.id==s&&e("#"+a+"-second-level").html(w(n.child.list||[],a,!0)).removeClass("uns")})}}function T(a){y(a),e("#"+a+"-first-level").click(function(t){e("#"+a+"-first-level .search-tab-list-item").removeClass("active"),e(t.target).addClass("active");var n=e(t.target).data("type");e(t.target).data("value")<=0?e(".search-tab-list-second-level").addClass("uns"):"region"!=n||searchTabConfig.noRegionSecond?"subway"==n&&e("#subway-second-level").removeClass("uns"):e("#region-second-level").removeClass("uns");var s=e(t.target).data("value"),r=[];e.each(searchTabConfig.data[a],function(e,a){return a.id==s?(r=a.child.list||[],!1):void 0}),e("#"+a+"-second-level").html(w(r,a,!1))}),e("#"+a+"-second-level").click(function(a){if(!e(a.target).hasClass("search-tab-list-item"))return!1;if(searchTabConfig.noAll)e(a.target).toggleClass("active"),0==e(this).find(".active").length&&e(a.target).addClass("active");else{var t=e(e(this)[0].firstChild);e(a.target).data("value")==t.data("value")?(e(e(this).children()).removeClass("active"),t.addClass("active")):(e(a.target).toggleClass("active"),0==e(this).find(".active").length?t.addClass("active"):t.removeClass("active"))}})}function w(a,n,s){var r=[],i=s?searchTabConfig.selected[t(n+"Second")]:"",c=i?i.split("_"):[];return e.each(a,function(e,a){r.push('<li data-value="'+a.id+'" class="search-tab-list-item'+(c.indexOf(a.id+"")>=0?" active":"")+'">'+a.name+"</li>")}),!s&&r[0]&&(r[0]=r[0].replace("search-tab-list-item","search-tab-list-item active")),r.join("")}function I(){0!==e(".h5_header").length&&e(".topmenu_box").addClass("search-top-menu");var a=e(".h5_header:not(.only_back)").height()||0;j=e(".search-tab").offset().top||0,O=j-a||0,e(window).scroll(function(){return L?!1:void x()}),0>O&&(x(),e(".searchTabWrapper").css("marginTop",Math.abs(O)))}function x(){e(window).scrollTop()>O?e(".search-tab").addClass(R):e(".search-tab-toggle-mask").hasClass("uns")&&e(".search-tab").removeClass(R)}function S(){e(".search-tab").hasClass(R)?L=!1:(L=!0,parseInt(j-N,10)>1?e(window).scrollTo({top:j-N+2},function(){L=!1}):L=!1,e(".search-tab").addClass(R))}function k(){e(".country").hasClass("active")?(e(".brand-area").show(),e(".search-tab-wrapper-content").scrollTop(1e3)):(e(".brand-area").find(".brandId-item").removeClass("active"),e(".brand-area").hide())}function _(){e.each(searchTabConfig.filterMap,function(e,a){M[e]=a,P[a]=e}),(!searchTabConfig.selected||e.isArray(searchTabConfig.selected))&&(searchTabConfig.selected={}),e(".search-tab-single-list").click(function(a){e(a.target).hasClass("search-tab-list-item")&&(e(this).find(".search-tab-list-item").removeClass("active"),e(a.target).addClass("active"))}),m(),d("price",{unit:"元／m²"}),d("area",{unit:"m²"}),d("hyPrice",{unit:"万元"}),v(),d("rent",{unit:"元／月"}),searchTabConfig.noRegionSecond?(y("region",!0),e("#region-first-level").click(function(a){e("#region-first-level .search-tab-list-item").removeClass("active"),e(a.target).addClass("active")})):T("region"),T("subway"),e(".search-tab-wrapper").click(function(a){e(a.target).hasClass("search-tab-submit-btn")?s(e(this).data("type")):e(a.target).hasClass("search-tab-clear-btn")&&("more"==e(this).data("type")&&H.more(!0),c(e(this).data("type")))}),e(".search-tab-item").click(function(){S();var a=e(this).data("value");return e(this).hasClass("spread")?(e(this).toggleClass("spread"),e(".search-tab-toggle-mask").addClass("uns"),x(),e("body").removeClass("bodyOverflowHidden")):(e(".search-tab-item").removeClass("spread"),e(this).addClass("spread"),e(".search-tab-toggle-mask").removeClass("uns"),setTimeout(function(){e("body").addClass("bodyOverflowHidden")},500)),e(".search-tab-wrapper:not(#search-tab-"+a+")").hide(),e("#search-tab-"+a).toggle(),!1}),e(".search-tab-toggle-mask").click(function(){r(),e("body").removeClass("bodyOverflowHidden")}),e(".search-tab-switch-item").click(function(a){var t=e(a.target).data("type");e("#search-tab-region").data("type",t),e("#search-tab-region .search-tab-switch-item").removeClass("active"),e(a.target).addClass("active"),e("#search-tab-region .search-tab-list").addClass("uns"),e("#"+t+"-list").removeClass("uns")}),b(),I(),k()}var j,O,M={},P={},A={region:["nb","regionSecond","region","subwaySecond","subway"],subway:["nb","regionSecond","region","subwaySecond","subway"]},E={success:function(e){var a=e.coords.latitude,t=e.coords.longitude;searchTabConfig.selected[M.region]="",searchTabConfig.selected[M.nb]=a+"_"+t,i()},error:function(e){switch(e.code){case e.TIMEOUT:alert("连接超时，请重试");break;case e.PERMISSION_DENIED:alert('您可以在"设置-隐私-定位服务"中开启定位服务，或选择筛选查询');break;case e.POSITION_UNAVAILABLE:alert("获取位置信息失败")}}},U={region:function(){y("region"),y("subway")},subway:function(){y("region"),y("subway")},price:function(){h("price")},hyPrice:function(){h("hyPrice")},price:function(){h("price")},hyType:function(){C("hyType")},rentType:function(){C("rentType")},sort:function(){C("sort")},rent:function(){h("rent")},area:function(){h("area")},layout:function(){e("#search-tab-layout .search-tab-content-item").removeClass("active")},applicationStatus:function(){C("applicationStatus")},publicType:function(){C("publicType")},more:function(){e("#search-tab-more .more-select").each(function(a,t){var n=e(t).data("type");U[n]&&U[n]()}),e("#search-tab-more .search-tab-content-item").removeClass("active"),e(".search-tab-more").removeClass("active")}},H={region:function(){searchTabConfig.noRegionSecond||(o("subway"),n("regionSecond"));var a=e("#search-tab-region .search-tab-list-item.active").data("value");if(-100==a){var t={enableHighAccuracy:!0,maximumAge:3e4,timeout:2e4};return navigator.geolocation.getCurrentPosition(E.success,E.error,t),!1}return searchTabConfig.selected[M.nb]="",a},regionSecond:function(){var a=[];return e.each(e("#region-second-level .search-tab-list-item.active"),function(t,n){a.push(e(n).data("value"))}),a.join("_")},subway:function(){o("region"),n("subwaySecond");var a=e("#subway-first-level .search-tab-list-item.active").data("value");return a},subwaySecond:function(){var a=[];return e.each(e("#subway-second-level .search-tab-list-item.active"),function(t,n){a.push(e(n).data("value"))}),a.join("_")},price:function(){return l("price")},hyPrice:function(){return l("hyPrice")},rent:function(){return l("rent")},area:function(){return l("area")},layout:function(){var a=[];return e(".layout-item.active").each(function(t,n){a.push(e(n).data("value"))}),a.join("_")},publicType:function(){return e("#search-tab-publicType .search-tab-list-item.active").data("value")},applicationStatus:function(){return e("#search-tab-applicationStatus .search-tab-list-item.active").data("value")},type:function(){var a=[];return e(".type-item.active").each(function(t,n){a.push(e(n).data("value"))}),a.join("_")},brandId:function(){var a=[];return e(".brandId-item.active").each(function(t,n){a.push(e(n).data("value"))}),a.join("_")},rentType:function(){var a=[];return e(".rentType-item.active").each(function(t,n){a.push(e(n).data("value"))}),a.join("_")},sort:function(){return e("#search-tab-sort .search-tab-list-item.active").data("value")},featureTags:function(){return u("featureTags")},discountTypes:function(){return u("discountTypes")},propertyTypes:function(){return u("propertyTypes")},saleStates:function(){return u("saleStates")},countries:function(){return e("#search-tab-countries .search-tab-list-item.active").data("value")},hyType:function(){return e("#search-tab-hyType .search-tab-list-item.active").data("value")},more:function(a){e.each(e(".more-select"),function(t,s){var r=e(s).data("type");n(r,a)})},nb:function(){return""}},L=!1,N=e(".h5_header:not(.only_back)").height()||0,R=N>0?"fix-search":"fix-search-zero";e.fn.scrollTo=function(a){var t={top:0,durTime:10,delay:30,callback:null},n=e.extend(t,a),s=null,r=this,i=r.scrollTop(),c=n.top-i,o=0,l=Math.round(n.durTime/n.delay),u=function(e){o++;var a=Math.round(c/l);return o>=l?(r.scrollTop(e),window.clearInterval(s),void(n.callback&&"function"==typeof n.callback&&n.callback())):void r.scrollTop(i+o*a)};return s=window.setInterval(function(){u(n.top)},n.delay),r},_()})});