define("common:components/ui/baiduMap/baiduMap.js",function(e){function i(e,i){this._center=e,this._htmlContent=i}function o(e,i,o){this._center=e,this._htmlContent=i,this._total=o}function n(e){this.options=a.extend({dom:"",pageType:"around",autoCreateMap:!1,housePoint:"",loupanName:"",dragging:!0,pinchToZoom:!0,scrollWheelZoom:!0,createLabel:!0,houseAddress:"",houseTotal:""},e||{}),this.init()}var t,a=e("common:components/ui/zepto/zepto.js"),r=e("common:components/ui/tips/tips.js"),p=e("common:components/ui/template/template.js"),s=function(e,i,o){if(null==e)return"";var n="",t=typeof e;if("string"==t||"number"==t||"boolean"==t)n+="&"+i+"="+(null==o||o?encodeURIComponent(e):e);else for(var a in e){var r=null==i?a:i+(e instanceof Array?"["+a+"]":"."+a);n+=s(e[a],r,o)}return n};return i.prototype=new BMap.Overlay,i.prototype.initialize=function(e){this._map=e;var i=document.createElement("div");i.style.cssText="position:absolute; height:30px; background:rgba(63,81,181,1); color:#fff; border-radius:15px;padding:0 8px; width:auto;font-size:12px; line-height:30px; white-space:nowrap",i.innerHTML=this._htmlContent,e.getPanes().markerPane.appendChild(i),this._width=i.offsetWidth,this._height=i.offsetHeight;var o=document.createElement("em"),n=this._width/2-8,t=this._height-3;i.appendChild(o),o.style.cssText="position:absolute;z-index:5; display:block;width:0;height:0;top:"+t+"px;left:"+n+"px;border-top:8px solid rgba(63,81,181,1);border-right:8px solid transparent;border-left:8px solid transparent;";var a=document.createElement("em"),r=this._width/2-8,p=this._height-2;return i.appendChild(a),a.style.cssText="position:absolute; z-index:4;display:block;width:0;height:0;top:"+p+"px;left:"+r+"px;border-top:8px solid rgba(63,81,181,1);border-right:8px solid transparent;border-left:8px solid transparent;",this._div=i,this._div},i.prototype.draw=function(){var e=this._map.pointToOverlayPixel(this._center);this._div.style.left=e.x-(this._width/2-2)+"px",this._div.style.top=e.y-(this._height+22+9)+"px"},i.prototype.show=function(){this._div&&(this._div.style.display="")},t=i,o.prototype=new BMap.Overlay,o.prototype.initialize=function(e){this._map=e;var i=document.createElement("div");i.style.cssText="position:absolute; z-index:4;";var o=p.parse('<div style=" padding: 8px 24px; min-width: 165px; border-radius: 26px; background: #fff;box-shadow: 0 2px 10px 0 rgba(0,0,0,0.15);">\r\n    <p style="color: #333; font-size: 14px;"><%= address %></p>\r\n    <p style=" color: #666; font-size: 12px;">附近<b style="color:rgb(254,93,89) "><%= total %></b>套租房</p>\r\n    <em style="font-size: 12px; position: absolute; right: 16px; top: 50%; margin-top: -6px; color: #999" class="iconfont icon-arrow_left"></em>\r\n</div>',{address:this._htmlContent,total:this._total});return i.innerHTML=o,e.getPanes().markerPane.appendChild(i),this._width=i.offsetWidth,this._height=i.offsetHeight,this._div=i,this._div},o.prototype.draw=function(){var e=this._map.pointToOverlayPixel(this._center);this._div.style.left=e.x-(this._width/2-2)+"px",this._div.style.top=e.y-(this._height/2+20)+"px"},o.prototype.show=function(){this._div&&(this._div.style.display="")},drawIndexMasker=o,n.prototype={config:{mapApi:"//api.map.baidu.com/api?v=2.0&ak=dCfxVQH8PlNRzQgP51QLOxCbgyNUbXVz",placeApi:"//api.map.baidu.com/place/v2/search?ak=dCfxVQH8PlNRzQgP51QLOxCbgyNUbXVz",sStaticDomain:window.config.aURL.sStaticDomain,icons:{loupan:function(){var e={url:window.config.aURL.sStaticDomain+"/static/govzf/common/c_/ui/baiduMap/img/pin/list_location_01aa20f.svg".replace(/\/static/gi,""),size:new BMap.Size(32,32),anchor:new BMap.Size(9,26)};return new BMap.Icon(e.url,e.size,{anchor:e.anchor})}(),bank:function(){var e={url:window.config.aURL.sStaticDomain+"/static/govzf/common/c_/ui/baiduMap/img/pin/pin_bank_ic_d70c3e6.svg".replace(/\/static/gi,""),size:new BMap.Size(32,32),anchor:new BMap.Size(9,26)};return new BMap.Icon(e.url,e.size,{anchor:e.anchor})}(),bus:function(){var e={url:window.config.aURL.sStaticDomain+"/static/govzf/common/c_/ui/baiduMap/img/pin/pin_bus_ic_36f3b27.svg".replace(/\/static/gi,""),size:new BMap.Size(32,32),anchor:new BMap.Size(9,26)};return new BMap.Icon(e.url,e.size,{anchor:e.anchor})}(),commiunty:function(){var e={url:window.config.aURL.sStaticDomain+"/static/govzf/common/c_/ui/baiduMap/img/pin/pin_community_ic_322fc45.png".replace(/\/static/gi,""),size:new BMap.Size(32,32),anchor:new BMap.Size(9,26)};return new BMap.Icon(e.url,e.size,{anchor:e.anchor})}(),food:function(){var e={url:window.config.aURL.sStaticDomain+"/static/govzf/common/c_/ui/baiduMap/img/pin/pin_food_ic_accb580.png".replace(/\/static/gi,""),size:new BMap.Size(32,32),anchor:new BMap.Size(9,26)};return new BMap.Icon(e.url,e.size,{anchor:e.anchor})}(),hospital:function(){var e={url:window.config.aURL.sStaticDomain+"/static/govzf/common/c_/ui/baiduMap/img/pin/pin_hospital_ic_b7d1b1a.png".replace(/\/static/gi,""),size:new BMap.Size(32,32),anchor:new BMap.Size(9,26)};return new BMap.Icon(e.url,e.size,{anchor:e.anchor})}(),metro:function(){var e={url:window.config.aURL.sStaticDomain+"/static/govzf/common/c_/ui/baiduMap/img/pin/pin_metro_ic_042014f.svg".replace(/\/static/gi,""),size:new BMap.Size(32,32),anchor:new BMap.Size(9,26)};return new BMap.Icon(e.url,e.size,{anchor:e.anchor})}(),school:function(){var e={url:window.config.aURL.sStaticDomain+"/static/govzf/common/c_/ui/baiduMap/img/pin/pin_school_ic_e76d0be.svg".replace(/\/static/gi,""),size:new BMap.Size(32,32),anchor:new BMap.Size(9,26)};return new BMap.Icon(e.url,e.size,{anchor:e.anchor})}(),shop:function(){var e={url:window.config.aURL.sStaticDomain+"/static/govzf/common/c_/ui/baiduMap/img/pin/pin_shop_ic_58e98f1.png".replace(/\/static/gi,""),size:new BMap.Size(32,32),anchor:new BMap.Size(9,26)};return new BMap.Icon(e.url,e.size,{anchor:e.anchor})}()},gSearchMap:{"公交":"bus","地铁":"metro","学校":"school","医院":"hospital","银行":"bank","购物":"shop","美食":"food","小区":"commiunty"},allTempMarker:[]},init:function(){var e=this;e._initBDMapCallBack(),e._createMasker()},_initBDMapCallBack:function(){var e=this;if(e.options.dom&&e.options.housePoint)if("panorama"==e.options.pageType){var i=new BMap.Panorama(e.options.dom);i.setPosition(new BMap.Point(e.options.housePoint[0],e.options.housePoint[1])),i.setPov({heading:-13,pitch:6})}else e.map=new BMap.Map(e.options.dom),"index"==e.options.pageType&&(e.mapPtIndex=new BMap.Point(e.options.housePoint[0],parseFloat(e.options.housePoint[1]-3e-4))),e.mapPt=new BMap.Point(e.options.housePoint[0],e.options.housePoint[1]),e.map.centerAndZoom(e.mapPt,18),e.map.disableDoubleClickZoom(),e.options.dragging||e.map.disableDragging(),e.options.pinchToZoom||e.map.disablePinchToZoom(),e.options.scrollWheelZoom||e.map.enableScrollWheelZoom();else r.show("没有传dom或坐标，请检查")},_createMasker:function(){var e=this;e.options&&e.options.pageType?"detail"==e.options.pageType?(e.masker=new t(e.mapPt,e.options.loupanName),e.map.addOverlay(e.masker)):"around"==e.options.pageType?(e.masker=new t(e.mapPt,e.options.loupanName),e.map.addOverlay(e.masker)):"index"==e.options.pageType&&(e.masker=new BMap.Marker(e.mapPtIndex,{icon:e.config.icons.loupan}),e.nameMasker=new drawIndexMasker(e.mapPt,e.options.houseAddress,e.options.houseTotal),e.map.addOverlay(e.masker),e.map.addOverlay(e.nameMasker)):r.show("请填写pageType，detail或around")},_searchPlace:function(e){var i=this;if(e&&e.query){var o,n=i.config.placeApi+s(e);return a.ajax({url:n,type:"get",dataType:"jsonp",async:!1,success:function(e){0==!e.status?(r.show(e.message),o=!1):o=e.results},error:function(){r.show("请求报错了")}}).then(function(e){return e.results})}r.show("还没有输入需要查询的建筑物")},_searchLocalPlace:function(e){var i=this,o=new BMap.LocalSearch(i.map,{renderOptions:{autoViewport:!0,selectFirstResult:!0},onSearchComplete:function(n){var t=[];if(o.getStatus()==BMAP_STATUS_SUCCESS){for(var a=0;a<n.getCurrentNumPois();a++){var r=n.getPoi(a),p=(r.point.lat,r.point.lng,r.address,r.title),s=new BMap.Marker(r.point,{icon:i.config.icons[i.config.gSearchMap[e.key]]});s.setTitle(p),i.map.addOverlay(s),t.push(s),s.addEventListener("click",function(e){i._openInfo(this.getTitle(),e)})}i.config.allTempMarker.push({id:e.key,tempMarker:t})}else console.log("附近没有相关设施")}});o.searchNearby(e.key,i.mapPt,2e3)},_openInfo:function(e,i){var o=i.target,n=this,t=new BMap.Point(o.getPosition().lng,o.getPosition().lat),a=new BMap.InfoWindow(e);n.map.openInfoWindow(a,t)},_getDistance:function(e,i){var o=this;return e&&i?parseInt(o.map.getDistance(e,i)):void r.show("请输入两个坐标")},_dealData:function(e){var i,o,n=this,t=[];i=n.mapPt;for(var a=0;a<e.length;a++){var r={};r.station=e[a].name,r.line=e[a].address.split("地铁").join("").replace(/;/g,"、"),o=new BMap.Point(e[a].location.lng,e[a].location.lat),r.distance=n._getDistance(i,o),t.push(r)}return t},get_place_distance:function(e){var i=this,o={};return o.query=e||"地铁",o.output="json",o.radius="1500",o.location=i.mapPt.lat+","+i.mapPt.lng,i._searchPlace(o).then(function(e){return i._dealData(e)})},set_place_point:function(e){var i=this;if(""==e)return r.error("请输入关键字"),!1;var o={key:e};i._searchLocalPlace(o)},delete_place_point:function(e){var i=this;if(""==e)return r.error("请输入关键字"),!1;for(var o=i.config.allTempMarker,n=0;n<i.config.allTempMarker.length;n++)if(o[n].id==e){for(var t=0;t<o[n].tempMarker.length;t++)i.map.removeOverlay(o[n].tempMarker[t]);o.splice(n,1)}}},n});