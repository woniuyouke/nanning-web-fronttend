define("common:components/pcUI/suggestion/suggestion.js",function(t,e,i){!function(e){"object"==typeof i&&"object"==typeof i.exports?i.exports=e(t("common:components/jquery/jquery.js"),t("common:components/pcUI/class/class.js"),t("common:components/pcUI/util/util.js")):e(window.jQuery,window.jQuery.klass,window.jQuery.util)}(function(t,e,i){var s=e.$factory("suggestion",{initialize:function(e){this.options=t.extend({dom:null,width:!1,max:10,caching:!0,url:null,data:null,delay:300,empty2close:!0,emptyNoCache:!1,kw:"kw",requestParams:{},dataField:"",matchKwField:"",match:null,format:null},e||{}),this.init()},init:function(){var e=this,i=e.options;e.cache={},e.dom=t(i.dom).attr("autocomplete","off"),e.parent=e.dom.parent(),!/fixed|absolute/.test(e.parent.css("position"))&&e.parent.css("position","relative"),e.suggest=t('<ul class="ui2-suggestion"><li class="ui2-suggestion-header"></li><li class="ui2-suggestion-footer"></li></ul>').appendTo(e.parent),e.xhr=null,e.tid=null,e.index=null,e.setData(i.data),e.initEvent()},initEvent:function(){var e=this,i=(e.options,!1);e.dom.on("keyup paste cut",function(t){if(13==t.keyCode){var i=e.suggest.find(".ui2-suggestion-active");return i.length&&e.setKw(i.attr("data-suggestion-kw"),i,!0),e.close()}!s.isUDEvent(t)&&e.match()}).focus(function(){e.match()}).keydown(function(t){s.isUDEvent(t)&&e.switchKw(t)}).blur(function(){i||(e.close(),e.trigger("cancel"))}),e.suggest.delegate(".ui2-suggestion-item","click",function(){e.setKw(t(this).attr("data-suggestion-kw"),t(this).attr("data-suggestion-index"),!0),e.close()}).hover(function(){i=!0},function(){i=!1}),e.suggest.find(".ui2-suggestion-header, .ui2-suggestion-footer").click(function(){e.dom.focus()})},setKw:function(t,e,i){var s=this;s.dom.val(t),i&&s.trigger("select",[t,s.finalData[e]])},switchKw:function(t){var e=this;if(e.items){var i=t.keyCode,s=e.items.length-1,n=null==e.index?-1:e.index;38==i?n--:n++,0>n?n=s:n>s&&(n=0),e.index=n,e.items.removeClass("ui2-suggestion-active");var o=e.items.eq(n).addClass("ui2-suggestion-active"),a=o.attr("data-suggestion-kw");e.setKw(a),e.trigger("switch",[a]),t.preventDefault()}},setData:function(t){this.data=t},setHeader:function(t){var e=this.suggest.find(".ui2-suggestion-header");t?e.html(t).show():e.hide()},setFooter:function(t){var e=this.suggest.find(".ui2-suggestion-footer");t?e.html(t).show():e.hide()},setRequestParams:function(t){this.options.requestParams=t},match:function(){var e=this,s=e.options;e.cancelMatch(),e.tid=setTimeout(function(){var n=e.dom.val();if(!t.trim(n)&&s.empty2close)return void e.close();var o=e.data,a=!s.caching||!t.trim(n)&&s.emptyNoCache?!1:e.cache[n];if(o)s.dataField&&(o=i.object.get(o,s.dataField)||[]),(o=e._match.call(e,o,n)).length&&e.build(o,n);else if(a)e.build(a,n);else if(s.url){var u=t.extend({},s.requestParams);u[s.kw]=n,e.xhr=t.getJSON(s.url,u,function(t){s.dataField&&(t=i.object.get(t,s.dataField)||[]),t=e.cache[n]=e._match.call(e,t,n),e.build(t,n)})}},s.delay)},cancelMatch:function(){var t=this;t.xhr&&t.xhr.abort(),t.tid&&clearTimeout(t.tid)},_match:function(t,e){var i=this,s=i.options;return s.match&&(t=s.match.call(i,t,e)),t.slice(0,s.max)},build:function(e,i){var s=this,n=s.options;if(s.index=null,s.suggest.find(".ui2-suggestion-item").remove(),s.finalData=e,e.length){var o="";t.each(e,function(t,e){var a="string"==typeof e?e:e[n.matchKwField];o+='<li class="ui2-suggestion-item" data-suggestion-index="'+t+'" data-suggestion-kw="'+a+'">'+String(s.format(e,i))+"</li>"}),s.items=t(o),s.suggest.find(".ui2-suggestion-header").after(s.items),s.open(),s.trigger("build")}else s.items=null,s.close()},open:function(){var t=this;if(t.items){var e=t.dom,i=e.position();t.suggest.show().css({left:i.left,top:i.top+e.outerHeight(),width:t.options.width||e.outerWidth()-2})}},close:function(){var t=this;t.suggest.hide()},format:function(t,e){var i=this,s=i.options;return s.format?s.format.call(i,t,e):"string"==typeof t?t:t[s.matchKwField]}});return s.isUDEvent=function(t){return 38==t.keyCode||40==t.keyCode},s})});