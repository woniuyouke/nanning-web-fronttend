define("common:components/pcUI/calendar/calendar.js",function(e,t,a){!function(t){"object"==typeof a&&"object"==typeof a.exports?a.exports=t(e("common:components/jquery/jquery.js"),e("common:components/pcUI/class/class.js"),e("common:components/pcUI/util/util.js"),e("common:components/pcUI/droplist/droplist.js")):t(window.jQuery,window.jQuery.klass,window.jQuery.util,window.jQuery.fn.droplist)}(function(e,t,a,n){var r=a.string.toPad,o=document,i=t.$factory("calendar",{initialize:function(t){this.options=e.extend({container:o.body,target:null,dom:null,maxDate:null,minDate:null,yearRange:null,dateFormat:"Y-m-d",selectedClassName:""},t||{}),this.init()},init:function(){var t=this,a=t.options;t.target=e(a.dom||a.target),t.target.length||(t.target=null),t.wraper=e('<div class="ui2-calendar"></div>'),t.container=e(a.container).append(t.wraper),t.date=null,t.initCalendar(),t.container[0]==o.body&&t.wraper.css("position","absolute"),a.minDate&&(t.minDate="string"==typeof a.minDate?a.minDate:t.getDate(a.minDate)),a.maxDate&&(t.maxDate="string"==typeof a.maxDate?a.maxDate:t.getDate(a.maxDate)),t.toMonth(),t.initEvent(),!t.target&&t.open()},initCalendar:function(){var t=this;t.calendar=e('<table class="ui2-calendar-container" />').appendTo(t.wraper);var a=t.options.yearRange,o=[];e.each(i.WEEKNAME,function(e,t){o.push("<th>"+t+"</th>")});var s=e(["<thead>",'<tr class="ui2-calendar-title">','<th colspan="7">',a?"":'<a href="javascript:" class="ui2-calendar-next"></a>',a?"":'<a href="javascript:" class="ui2-calendar-prev"></a>','<div class="ui2-calendar-date"></div>',"</th>","</tr>","<tr>"+o.join("")+"</tr>","</thead>"].join("")).appendTo(t.calendar);if(a){a=a.split(":");for(var l={},c={},d=i.getYM(),u=Math.min(d.year,a[0]),h=Math.max(d.year,a[1]);h>=u;u++)l[u]=u;for(var p=1;12>=p;p++)c[" "+r(p,0,2,!0)]=p;var m=e('<div class="ui2-calendar-year-range"></div>'),g=e('<div class="ui2-calendar-month-range"></div>');s.find(".ui2-calendar-date").append(m,g),t.yearSelecter=new n({container:m,height:18,width:58,list:l,defaultValue:d.year}),t.monthSelecter=new n({container:g,height:18,width:42,list:c,defaultValue:d.month})}},initEvent:function(){var t=this,a=t.options;t.target&&(t.o2s(t.target,"click",function(){t.open(),t.resetPosition()}),t.o2s(window,"resize scroll",function(){t.resetPosition()}),t.o2s(document,"click",function(e){e.target!=t.target[0]&&t.close()}),t.on("select",function(e,a){"value"in t.target[0]?t.target.val(a):t.target.html(a),t.close()})),t.wraper.click(function(n){var r=e(n.target);r.hasClass("ui2-calendar-item")&&!r.hasClass("ui2-calendar-item-disable")&&(a.selectedClassName&&(t.cleanSelected(),r.addClass(a.selectedClassName)),t.date=r.attr("data-calendar-date"),t.trigger("select",t.date,r)),n.stopPropagation()}),a.yearRange?(t.yearSelecter.on("select",function(e,a){t.toMonth(a)}),t.monthSelecter.on("select",function(e,a){t.toMonth(t.year,a)})):(t.wraper.delegate(".ui2-calendar-prev","click",function(e){t.prevMonth(),e.stopPropagation()}),t.wraper.delegate(".ui2-calendar-next","click",function(e){t.nextMonth(),e.stopPropagation()}))},prevMonth:function(){this.toMonth(this.year,this.month-1)},nextMonth:function(){this.toMonth(this.year,this.month+1)},toMonth:function(e,t){var a=this,n=i.getYM(e,t);a.year=n.year,a.month=n.month,a.options.yearRange?(a.yearSelecter.setValue(e),a.monthSelecter.setValue(t)):a.calendar.find(".ui2-calendar-date").text(a.year+"."+r(a.month,0,2,!0)),a.renderItems(),a.trigger("switch",[a.year,a.month]),a.resetPosition()},renderItems:function(){for(var e=this,t=e.options,a=e.month-1,n=e.year,r=new Date(n,a,1),o=new Date(n,a+1,0),i=e.getDate(new Date),s=r.getDay(),l=o.getDate(),c=Math.ceil((s+l)/7),d=[],u=1,h=0;c>h;h++){for(var p=[],m=0;7>m;m++)if(s>m&&0==h||u>l)p.push("<td>&nbsp;</td>");else if(l>=u){var g=e.getDate(new Date(n,a,u)),f="ui2-calendar-item";i==g&&(f+=" ui2-calendar-item-today"),e.date==g&&(f+=" "+t.selectedClassName),(e.minDate&&g<e.minDate||e.maxDate&&g>e.maxDate)&&(f+=" ui2-calendar-item-disable"),p.push('<td><a href="javascript:" data-calendar-date="'+g+'" class="'+f+'" title="'+g+'">'+u++ +"</a></td>")}d.push("<tr>"+p.join("")+"</tr>")}e.calendar.find("tbody").remove(),e.calendar.append("<tbody>"+d.join("")+"</tbody>")},open:function(){this.wraper.show(),this.resetPosition(),this.trigger("open")},close:function(){this.wraper.hide(),this.trigger("close")},resetPosition:function(){if(this.target){var t,a=this,n=a.target.offset(),r=o.body.scrollTop||o.documentElement.scrollTop;t=r+e(window).height()<n.top+a.wraper.outerHeight()?n.top-a.wraper.outerHeight()-1:n.top+a.target.outerHeight()+1,a.wraper.css({left:n.left,top:t})}},getDate:function(e){return a.date.date(this.options.dateFormat,e.getTime())},destroy:function(){var e=this;e.yearSelecter&&e.yearSelecter.destroy(),e.yearSelecter=null,e.monthSelecter&&e.monthSelecter.destroy(),e.monthSelecter=null,e.wraper.remove(),e.wraper=null,e.container=null,e.target&&e.ofs(e.target,"click"),e.ofs(window,"resize scroll"),e.ofs(document,"click")},cleanSelected:function(){var e=this,t=e.options.selectedClassName;t&&(e.date=null,e.calendar.find(".ui2-calendar-item").removeClass(t))}});return i.WEEKNAME=["日","一","二","三","四","五","六"],i.getYM=function(e,t){var a=new Date;return e&&a.setFullYear(e),null!=t&&(a.setDate(1),a.setMonth(t-1)),{year:a.getFullYear(),month:a.getMonth()+1}},i})});